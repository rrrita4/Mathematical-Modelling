var loadingBeforeDownload;
var timerLoadingBeforeDownload;
var loadingBeforeDownloadTimeoutStatus = false;
//下载文档
var isIe678 = !-[1, ],
	iAsync = isIe678 ? false : true;
//复制功能
if (!testIE8()) {
	LoadJS(picture_image_path_v1 + "/js/clipboard.min.js", 1); //加载剪切板
}
LoadJS(picture_image_path_v1 + "/js/ipadreader/iscroll.js", 1);

function showLoadingBeforeDownload(productId, fn, souece, uid, flag){
	var PayWayTips = '&nbsp;';
	var payStatusTips = '&nbsp;';
	var payWayClass = 'pay-before'
	var timerTimeout;
	if (souece == 1) {// 三方付费充值
		// PayWayTips = '正等待第三方支付返回结果';
		payStatusTips = '即将开始下载';
		// payWayClass = '';
	} else if (souece == 2 || souece == 3) {// 豆元减扣
		// PayWayTips = '正等待系统支付返回结果';
		payStatusTips = '即将开始下载'
		// payWayClass = '';
	}

	loadingBeforeDownload = new CreateDocinDialog({
		title: ' ',
		id: 'loading-before-download',
		cls: 'loading-before-download '+payWayClass,
		content: '<div class="loader-wrap" style="position: absolute;top:0;left:0;right:0;height:100%;z-index:10000;background:rgba(255,255,255,0.8);font-size:16px;color:#fff;text-align:center;vertical-align:middle;box-sizing:border-box;"> <div class="loading-before-download-tips"><div class="t1">'+PayWayTips+'</div><div class="t2">'+payStatusTips+'</div></div> <div class="loader-animation">Loading...</div><div class="loading-before-download-btns"><span class="loading-before-download-btn b1">重试</span><span class="loading-before-download-btn b2">继续等待</span></div></div>',
		button: 2,
		shadow: 1,
		init: function(){
			loadingBeforeDownloadTimeoutFn();
			jQuery(window).on('keyup', function(e){
				if (e.keyCode===27) {
					loadingBeforeDownload.closeDialog();
				}
			})
		},
		closeCallBack: function(){
			loadingBeforeDownloadTimeoutStatus = false;
			clearTimeout(timerTimeout);
		}
	});
	function loadingBeforeDownloadTimeoutFn()  {
		timerTimeout = setInterval(function() {
			if (loadingBeforeDownloadTimeoutStatus) {
				console.log('timeout:', loadingBeforeDownloadTimeoutStatus)
				loadingBeforeDownloadTimeoutStatus = false;
				jQuery('.loading-before-download').removeClass('pay-before');
				jQuery('.loading-before-download-btns').show();
				jQuery('.loading-before-download-tips .t2').text('呃~ 网速有点卡');
				clearTimeout(timerTimeout);
				jQuery(document).off('click', '.loading-before-download-btn').on('click', '.loading-before-download-btn', function(){
					jQuery('.loading-before-download').addClass('pay-before');
					jQuery('.loading-before-download-btns').hide();
					jQuery('.loading-before-download-tips .t2').html(payStatusTips);
					loadingBeforeDownloadTimeoutFn();
					if (souece == 3) {
						purchaseAjax(productId, uid, flag)
					} else {
						downLoadNew(productId, fn);
					}
				});
			}				
		}, 1000);
	}
}
function hideLoadingBeforeDownload(){
	loadingBeforeDownloadTimeoutStatus = false;
	clearTimeout(timerLoadingBeforeDownload);
	if (loadingBeforeDownload) {
		loadingBeforeDownload.closeDialog();
	}
}
function downLoadNew(productId, fn) {
	if (jQuery('.outerProg').length != 0) {
		return false
	}
	var random = new Date().getTime();
	var iCid = 0;
	// if(typeof(iQuanCid)!="undefined"){
	// 	iCid = iQuanCid;
	// }
	if (jQuery("#coupon_sel").length > 0) {
		iCid = jQuery('#coupon_sel option:selected').data("cid");
	}
	if(readerConfig.ticketid!=undefined){
		iCid = readerConfig.ticketid;
	}
	jQuery.ajax({
		type: 'GET',
		url: "/newEnd/down_load_new_v1.do",
		dataType: "html",
		async: iAsync,
		context: document.body,
		data: "pid=" + productId + "&fn=" + fn + "&flag=down&cid=" + iCid + "&datetime=" + random,
		single: "download",
		timeout: 16000,
		success: function (data) {
			if (data) {
				// console.log(data);
				hideLoadingBeforeDownload();
				var index = data.indexOf("1|");
				var index2 = data.indexOf("co188|");
				if (index == 0 || index2 == 0) { //文档可直接下载
					var downPath = data.split("|")[1];
					if ((typeof (isFreeProduct) != "undefined" && isFreeProduct == "1") && (typeof (isZuZhi) != "undefined" && isZuZhi == "1")) { //免费文档下载加限制
						mailDialogAlert(login_email, landingEmail, domailUrl);
						return false;
					}
					downloadSuccess(productId);
					jQuery('body').append('<iframe style="display:none" id="iframe_data" src="' + downPath + '"></iframe>');
					return false;
				}
				if (data == "1" || data == "2") { //yidun
					showDownLoadSign(1, data, productId, fn);
					return false;
				} else if (data == "3" || data == "4") { //docin 
					showDownLoadSign(2, data, productId, fn);
					return false;
				} else if (data.indexOf("zq") > -1&&readerConfig.is_zq=="true") { //若文档为掌桥文档
					var iZQinfo = data.split("|");
					if (iZQinfo.length == 4) {
						zqBuySuccess(iZQinfo[1], iZQinfo[2], iZQinfo[3]);
					}
				} else {
					var oHtml = data;
					jQuery(this).append(oHtml);
				}
				//充值  购买  企业vip
				if (idflag == "downLoadTips1" || idflag == "downLoadTips2" || idflag == "downLoadTips4" || idflag == "downLoadTips8" || idflag == "downLoadTips9" || idflag == "downLoadTips16" || idflag == "j_limit_down") {
					if (data.indexOf("zq") == -1) {
						dialogBoxShadow();
					}
				}
				if (idflag != 'downLoadTips3' && idflag != 'downLoadTips7' && idflag != "") {
					setObjCenter(idflag);
				} else {
					loadremaind();
				}
				if (idflag == "downLoadTips1") {
					//下载、购买提示
					if (jQuery(".zk").length > 0) {
						jQuery(".zk").click(function () {
							var $index = jQuery(".zk").index(this);
							jQuery(".cz_btn").hide();
							jQuery(".cz_btn").eq($index).show();
							jQuery(".zk").show();
							jQuery(this).hide();
						});
					}
				}
			} else {
				loadingBeforeDownloadTimeoutStatus = true;
			}
		},
		error: function(error){
			loadingBeforeDownloadTimeoutStatus = true;
		}
	});
}
//验证码验证之后快速下载
function downloadFast(iData, pid) {
	var newData = JSON.parse(iData);
	var downPath = newData.downUrl;
	var goProgress = newData.isGo;
	if ((typeof (down_flag) != 'undefined' && (down_flag == 'contract' || down_flag == 'huiyi')) || !goProgress) { //此条件是合同，会议，土木都不走进度条下载
		downloadSuccess(pid);
		jQuery('body').append('<iframe style="display:none" id="iframe_data" src="' + downPath + '"></iframe>');
		return false;
	}
	downloadSuccess(pid);
	createFrame(downPath); //创建iframe下载文档
	return false;
}

function createFrame(url) {
	var oIrame = document.createElement('iframe');
	oIrame.style.width = "0px";
	oIrame.style.height = "0px";
	oIrame.style.opacity = 1;
	document.body.appendChild(oIrame)
	oIrame.src = url;
	var IfDoc = oIrame.contentDocument || oIrame.document;
	oIrame.onreadystatechange = function () { // IE下的节点都有onreadystatechange这个事件  
		if (oIrame.readyState == "complete") {
			// oIrame.execCommand("SaveAs", true, name)
			document.body.removeChild(oIrame)
		}
	};

}
//下载之前验证码验证
function showDownLoadSign(f, data, pid, fn) {
	if (f == 1) { //易盾验证码
		var showOrder = "请验证后保存文档";
		if (data == "1") showOrder = "支付成功，请验证后保存文档";
		var captchaIns;
		var downLoadSign = new CreateDocinDialog({
			title: showOrder,
			id: 'j_downloadSign',
			cls: 'downloadSign',
			content: '<div style="font-size:14px;"><a class="contact_qq" style="float:right;color:#d0d0d0;text-decoration:underline;" href="javascript:void(0);" onmousedown="inpmv(6539);">联系在线客服</a>滑动拼图完成验证</div><div style="margin: 10px auto;min-height:215px;width:324px;" id="captcha_div"></div><div id="j_savedoc" style="margin-top:15px;text-align:center;"><span class="dBtn-btn dBtn-disabled">保存文档</span></div>',
			button: 2,
			shadow: 1,
			init: function () {
				jQuery(".contact_qq").unbind("click").bind("click", function () {
					if (jQuery(".connectOnline a").length > 0) {
						jQuery(".connectOnline a").click();
					}
				});
				jQuery('<p style="color:#ccc;font-size:14px;height:200px;line-height:200px;text-align:center;">正在初始化...</p>').appendTo(jQuery("#captcha_div"));
				loadScript("//cstaticdun.126.net/load.min.js", function () {
					//jQuery("#captcha_div").html("");
					initNECaptcha({
						captchaId: '24c47721ed2e417b82eab8e83489305d',
						element: '#captcha_div',
						mode: 'embed',
						width: '320px',
						onReady: function () {
							downLoadSign.setCenter();
						},
						onVerify: function (err, data) {
							if (err) return;
							jQuery("#j_savedoc span").removeClass("dBtn-disabled").addClass("dBtn-Qblue1").html('正在保存<i class="ani_dot">...</i>');
							jQuery.ajax({
								url: "/newEnd/codeIsRight.do",
								async: iAsync,
								data: "pid=" + pid + "&code=" + data.validate + "&fn=" + fn,
								success: function (idata) {
									if (idata != "-1") {
										//downLoadNew(pid,fn);
										//下载
										downloadFast(idata, pid);
										downLoadSign.closeDialog();
									} else if (idata == "-5") {
										var oSorryDiv = new CreateDocinDialog({
											id: 'sorryNoFind',
											cls: 'sorry_nofind',
											title: " ",
											content: '<p class="txt1"><img src="' + picture_image_path_v1 + '/images_cn/news/html_reader/pic_no_find.jpg" /></p><p class="txt2">下载遇到问题，我要 <a  href="javascript:void(0)" title="联系在线客服" onclick="link_service();"><img style="vertical-align:middle;" border="0" src="<%=urlPrefix.cdn %>/images_cn/zx_qq.gif"  height="21"/></a></p>',
											button: 2,
											shadow: 1
										});
										commonConutHideBox('sorryNoFind', 1, 2);

										function link_service() {
											if (jQuery(".connectOnline").length > 0) {
												jQuery(".connectOnline a").click();
											}
										}

									} else {
										captchaIns.refresh();
										jQuery("#j_savedoc span").removeClass("dBtn-Qblue1").addClass("dBtn-disabled").html('保存文档');
									}
								}
							});
						}
					}, function onload(instance) {
						captchaIns = instance;
					}, function onerror(err) {});
				});
			}
		});
	} else if (f == 2) { //网站验证码
		var showOrder = "请验证后保存文档";
		if (data == "3") showOrder = "支付成功，请验证后保存文档";
		var downLoadSign = new CreateDocinDialog({
			title: showOrder,
			id: 'j_downloadSign',
			cls: 'downloadSign',
			content: '<div style="font-size:14px;"><a style="float:right;color:#d0d0d0;text-decoration:underline;" class="service_kf" href="javascript:void(0);" onmousedown="inpmv(6539);">联系在线客服</a>输入验证码</div><div class="downloadLimitCode" style="margin: 15px auto;min-height:70px;width:324px;"><input type="text" class="yzm_input" style="width:164px;height:40px;" id="downloadCode" name="downloadCode" maxlength="5" tabindex="5"><img width="90" height="40" id="downloadimg" name="downloadimg" src="/servlet/getctime?from=downcodenew&pid=' + pid + '" alt="" title="请输入图片中的字符" /><a id="changeCode" style="font-size:12px;" title="换张图片" href="javascript:void(0);">换张图</a><div id="errorTips" style="color:#ff0000;padding-top:5px;"></div></div><div id="j_savedoc" style="margin-top:15px;text-align:center;"><span class="dBtn-btn dBtn-false" style="width:100%;">保存文档</span></div>',
			button: 2,
			shadow: 1,
			init: function () {
				refreshDownloadCode();

				function refreshDownloadCode() {
					var oDownloadCodeImg = jQuery('#downloadimg');
					if (oDownloadCodeImg.length > 0) {
						oDownloadCodeImg.attr('src', '/servlet/getctime?from=downcodenew&pid=' + pid + '&t=' + new Date().getTime());
					}
				}
				jQuery("#changeCode,#downloadimg").click(function () {
					refreshDownloadCode();
				});
				var oDownLoadCodeInput = jQuery("#downloadCode");
				if (oDownLoadCodeInput.length == 0) {
					return;
				}
				oDownLoadCodeInput.focus();
				oDownLoadCodeInput.bind("keyup", function (event) {
					if (event.keyCode == 13) {
						jQuery("#j_savedoc span").click();
						oDownLoadCodeInput.blur();
					}
				});
				oDownLoadCodeInput.on("input propertychange", function () {
					if (oDownLoadCodeInput.val() != "" && !jQuery("#j_savedoc span").hasClass("dBtn-Qblue")) {
						jQuery("#j_savedoc span").removeClass("dBtn-false").addClass("dBtn-Qblue");
					} else if (oDownLoadCodeInput.val() == "") {
						jQuery("#j_savedoc span").removeClass("dBtn-Qblue").addClass("dBtn-false");
					}
				});
				oDownLoadCodeInput.bind("focus", function () {
					jQuery('#errorTips').html("");
				});
				jQuery("#j_savedoc").on("click", '.dBtn-Qblue', function () {
					var yzmValue = oDownLoadCodeInput.val();
					if (yzmValue == "") {
						jQuery('#errorTips').html("验证码错误，请重新输入");
						refreshDownloadCode();
						return false;
					}
					jQuery.ajax({
						type: 'GET',
						url: "/newEnd/codeIsRight.do",
						async: iAsync,
						data: "pid=" + pid + "&code=" + yzmValue + "&fn=" + fn,
						success: function (idata) {
							if (idata != "-1") {
								//downLoadNew(pid,fn);
								//下载
								downloadFast(idata, pid);
								downLoadSign.closeDialog();
							} else if (idata == "-5") {
								var oSorryDiv = new CreateDocinDialog({
									id: 'sorryNoFind',
									cls: 'sorry_nofind',
									title: " ",
									content: '<p class="txt1"><img src="' + picture_image_path_v1 + '/images_cn/news/html_reader/pic_no_find.jpg" /></p><p class="txt2">下载遇到问题，我要 <a  href="javascript:void(0)" title="联系在线客服" onclick="link_service();"><img style="vertical-align:middle;" border="0" src="<%=urlPrefix.cdn %>/images_cn/zx_qq.gif"  height="21"/></a></p>',
									button: 2,
									shadow: 1
								});
								commonConutHideBox('sorryNoFind', 1, 2);

								function link_service() {
									if (jQuery(".connectOnline").length > 0) {
										jQuery(".connectOnline a").click();
									}
								}

							} else {
								jQuery('#errorTips').html("验证码错误，请重新输入");
								oDownLoadCodeInput.val("");
								jQuery("#j_savedoc span").removeClass("dBtn-Qblue").addClass("dBtn-false");
								refreshDownloadCode();
							}
						}
					});
				});
			}
		});
	}
}

function testIE8() {
	var DEFAULT_VERSION = 8.0;
	var ua = navigator.userAgent.toLowerCase();
	var isIE = ua.indexOf("msie") > -1;
	var safariVersion;
	if (isIE) {
		safariVersion = ua.match(/msie ([\d.]+)/)[1];
	}
	if (safariVersion <= DEFAULT_VERSION) {
		return true;
	};
	return false;
}
function nofind() {
    var img = event.srcElement;
    img.src = picture_image_path_v1 + '/images_cn/no_image/110x140_no.gif';
    img.onerror = null;
}
function loadremaind() {
	if (typeof (readerConfig) != "undefined" && readerConfig.isBuy == 0) {
		//有一种文档是免费下载，付费阅读的，这种下载后不会加载剩下的
		if (typeof (specialProd) != "undefined" && specialProd == "true") {
			//下载成功后可阅读全文
			if (jQuery("#j_pay").length > 0) {
				jQuery("#j_pay").addClass("disabled_btn").removeAttr('onclick');
				jQuery("#j_pay").html('<span class="iconfont iconfufei"></span>已付费');
			}
			if (jQuery("#j_pay_2").length > 0) {
				jQuery("#j_pay_2 span").removeClass('tool_btn_org').addClass('tool_btn_gray').removeAttr('onclick');
				jQuery("#j_pay_2 span").html('已付费');
			}
			if (jQuery(".doc_down_btn .iconfufei").length > 0) {
				jQuery(".doc_down_btn .iconfufei").parent().addClass("disabled_btn").removeAttr('onclick');
				jQuery(".doc_down_btn .iconfufei").parent().html('<span class="iconfont iconfufei"></span>已付费');
			}
			var datetime = new Date().getTime();
			jQuery.ajax({
				type: 'GET',
				url: "/newEnd/getSid.do",
				data: "pid=" + readerConfig.productId + "&d=" + datetime,
				success: function (data) {
					if (data != null && data != "") {
						readerConfig.flash_param_hzq = data;
						//付费后加载剩下的
						docinReader.config.isBuy = 2;
						if (typeof (iscanread) != "undefined" && iscanread == 0) {
							iscanread = 1;
						}
						docinReader.createDiv();
						docinReader.setReaderLogin();
						if (jQuery(".preview_end").length > 0) {
							jQuery(".preview_end").remove();
						}
					}
				}
			})



		}
	}
}

function completeTipsLayout() {
	if (jQuery(".reader_tools_bar_wrap .addMember").length == 1) {
		jQuery(".reader_tools_bar_wrap .addMember").on("click", function () {
			if (typeof (readerConfig) != "undefined" && readerConfig.isLogin == 1 && typeof (freeToUser) != "undefined" && freeToUser == "true") {
				var completeLayout = new CreateDocinDialog({
					title: "豆丁提示",
					id: 'j_completeLayout',
					cls: 'completeLayout',
					content: '<p class="applyTips1 clear"><img class="icon_warn" src="' + picture_image_path_v1 + '/images_cn/newDocin/head_bar/transparent.gif" />请您在新打开的<br>支付页面上完成支付</p><p class="applyTips2">支付完成前请不要关闭此窗口<br>完成支付后请根据实际情况点击下面的按钮</p>',
					button: 1,
					shadow: 1,
					cancel: {
						txt: "支付遇到问题",
						value: true
					},
					confirm: {
						txt: "已完成支付",
						value: true
					},
					callBack: {
						okBack: function () {
							downLoadNew(product_id);
							return true;
						},
						noBack: function () {
							var url = "/helpcenter/getProblem.do?pid=151";
							window.open(url);
							return true;
						}
					},
					init: function () {

					}
				});
			}
		});

	}

}
//VIP免费下载
function downLoadNewVip(productId, fn) {
	var datetime = new Date().getTime();
	closeDownLoadDiv('4');
	jQuery.ajax({
		type: 'GET',
		url: "/newEnd/vipFreeDownload_new.do",
		context: document.body,
		data: "pid=" + productId + "&fn=" + fn + "&datetime=" + datetime,
		success: function (data) {
			if (data) {
				var oHtml = data;
				jQuery(this).append(oHtml);
				//dialogBoxShadow();
				//setObjCenter(idflag);
			}
		}
	});
}
//点击下载，弹出下载成功  /newEnd/down_load_success.do?pid=xxx&clickType=2
function downloadSuccess(productId) {
	jQuery.ajax({
		type: 'GET',
		url: "/newEnd/down_load_success.do",
		//async:false,
		async: true,
		context: document.body,
		data: "pid=" + productId + "&clickType=2&free="+isFreeDoc+"&rand=" + new Date().getTime(),
		success: function (data) {
			if (data) {
				var oHtml = data;
				jQuery(this).append(oHtml);
				dialogBoxShadow();
				//动态开始加载收藏该文档的用户也收藏
				setTimeout(function () {
					sortCourseTime_ASC(2);
					setObjCenter("addFavSuccess");
					jQuery("#addFavSuccess").show();
					docinCopyData('copy1', 'docUrl2');
					setTimeout(function () {
						sortCourseTime_ASC(2);
					}, 500);
				}, 200);

			}
		}
	});
}
function docFuncHover(){// doc_fun_hover
	jQuery('.doc_addfav_btn').hover(function(){
		jQuery(this).find('.icons-svg').addClass('icons-sprite-ico_addfav_hover')
	}, function(){
		jQuery(this).find('.icons-svg').removeClass('icons-sprite-ico_addfav_hover')
	});
	jQuery('.doc_print_btn').hover(function(){
		jQuery(this).find('.icons-svg').addClass('icons-sprite-ico_print_hover')
	}, function(){
		jQuery(this).find('.icons-svg').removeClass('icons-sprite-ico_print_hover')
	});
	jQuery('.doc_convert_btn').hover(function(){
		jQuery(this).find('.icons-svg').addClass('doc icons-sprite-ico_convert_doc_hover')
	}, function(){
		jQuery(this).find('.icons-svg').removeClass('doc icons-sprite-ico_convert_doc_hover')
	});
	jQuery('.doc_modify_btn').hover(function(){
		jQuery(this).find('.icons-svg').addClass('icons-sprite-ico_modify_hover')
	}, function(){
		jQuery(this).find('.icons-svg').removeClass('icons-sprite-ico_modify_hover')
	});
	jQuery('.doc_build_share_btn').hover(function(){
		jQuery(this).find('.icons-svg').addClass('icons-sprite-ico_share_hover')
	}, function(){
		jQuery(this).find('.icons-svg').removeClass('icons-sprite-ico_share_hover')
	});
	jQuery('.docin_share_sns').hover(function(){
		jQuery(this).find('.icons-svg').addClass('icons-sprite-ico_share_hover')
	}, function(){
		jQuery(this).find('.icons-svg').removeClass('icons-sprite-ico_share_hover')
	});
}
//收藏到书房
//收藏到书房按钮开关
var addDocToBookShopBtn = {};
addDocToBookShopBtn.Ctrller = 'ture';
//收藏到书房 canvas
function addDocToBookshop(pid) {
	if (addDocToBookShopBtn.Ctrller == 'false') {
		return;
	}
	addDocToBookShopBtn.Ctrller = 'false';
	if (isZuZhi == "1") {
		mailDialogAlert(login_email, landingEmail, domailUrl)
		return;
	}


	if (jQuery("#selectFolder").length > 0) {
		if (jQuery("#dialogBoxShadow").length == 0) {
			dialogBoxShadow();
		}
		jQuery("#selectFolder").show();
		return false;
	}
	//按钮变为已收藏
	if (jQuery("#addBookShop").length > 0) {
		if (jQuery("#addBookShop").find(".iconfont").hasClass("iconshoucang_red")) {
			jQuery("#addBookShop").removeClass('add_bookshop_ok').html('<span class="iconfont iconshoucang"></span>收藏到书房');
			jQuery.ajax({
				type: 'GET',
				url: "/app/my/bookshelf/delproduct.do?productid=" + pid + "&bookhouseid=1&t=" + new Date().getTime(),
				success: function (data) {
					if (data != null && data.code == 1) {
						console.log("取消收藏成功");
					}
					addDocToBookShopBtn.Ctrller = "true";
				}
			});
		} else {
			jQuery("#addBookShop").addClass('add_bookshop_ok').html('<span class="iconfont iconshoucang_red"></span>已收藏');
			jQuery.ajax({
				type: 'GET',
				url: "/app/dwrutil/showFavoriteCode.do?from=newend&pid=" + pid + "&t=" + new Date().getTime(),
				success: function (data) {
					if (data != null && data.indexOf('div') > -1) {
						if (jQuery("#userfavoriteproductdiv") != null) {
							jQuery("#userfavoriteproductdiv").remove();
						}
						var oHtml = data;
						jQuery(document.body).append(oHtml);
						addDocToBookShopBtn.Ctrller = 'true';
					} else { //可以收藏
						jQuery.ajax({
							type: 'GET',
							url: "/newEnd/getUserFolders_New.do",
							context: document.body,
							data: "productId=" + pid + "&t=" + new Date().getTime(),
							success: function (data) {
								if (data) {
									jQuery('<div id="adFavWrap"></div>').appendTo(jQuery(this));
									var oHtml = data;
									var curScrollTop = 0;
									jQuery("#adFavWrap").append(oHtml);
									dialogBoxShadow();
									setObjCenter("selectFolder");
									if (jQuery("#folderUlBookhouse li.cur").hasClass("floder_forbid")) {
										curScrollTop = 0;
									} else {
										curScrollTop = jQuery("#folderUlBookhouse li.cur").position().top;
									}
									jQuery(".folder_box").scrollTop(curScrollTop);
									addDocToBookShopBtn.Ctrller = "true";
								}
							}
						});
					}
				}
			});
		}

	}

	if (jQuery(".doc_addfav_btn").length > 0 && jQuery(".doc_addfav_btn .ico_doc_addfav").length) {
		if (jQuery(".doc_addfav_btn").find(".ico_doc_addfav").hasClass("ico_doc_addfav_ok")) { //已收藏的，再点一下取消收藏
			jQuery(".doc_addfav_btn").find(".ico_doc_addfav").removeClass("ico_doc_addfav_ok");
			jQuery(".doc_addfav_btn").find(".fun_name").html("收藏");
			jQuery.ajax({
				type: 'GET',
				url: "/app/my/bookshelf/delproduct.do?productid=" + pid + "&bookhouseid=1&t=" + new Date().getTime(),
				success: function (data) {
					if (data != null && data.code == 1) {
						console.log("取消收藏成功");
					}
					addDocToBookShopBtn.Ctrller = "true";
				}
			});
		} else { //未收藏，点击收藏
			jQuery(".doc_addfav_btn").find(".ico_doc_addfav").addClass("ico_doc_addfav_ok");
			jQuery(".doc_addfav_btn").find(".fun_name").html("已收藏");
			jQuery.ajax({
				type: 'GET',
				url: "/app/dwrutil/showFavoriteCode.do?from=newend&pid=" + pid + "&t=" + new Date().getTime(),
				success: function (data) {
					if (data != null && data.indexOf('div') > -1) {
						if (jQuery("#userfavoriteproductdiv") != null) {
							jQuery("#userfavoriteproductdiv").remove();
						}
						var oHtml = data;
						jQuery(document.body).append(oHtml);
						addDocToBookShopBtn.Ctrller = 'true';
					} else { //可以收藏
						jQuery.ajax({
							type: 'GET',
							url: "/newEnd/getUserFolders_New.do",
							context: document.body,
							data: "productId=" + pid + "&t=" + new Date().getTime(),
							success: function (data) {
								if (data) {
									jQuery('<div id="adFavWrap"></div>').appendTo(jQuery(this));
									var oHtml = data;
									var curScrollTop = 0;
									jQuery("#adFavWrap").append(oHtml);
									dialogBoxShadow();
									setObjCenter("selectFolder");
									if (jQuery("#folderUlBookhouse li.cur").hasClass("floder_forbid")) {
										curScrollTop = 0;
									} else {
										curScrollTop = jQuery("#folderUlBookhouse li.cur").position().top;
									}
									jQuery(".folder_box").scrollTop(curScrollTop);
									addDocToBookShopBtn.Ctrller = "true";
								}
							}
						});
					}
				}
			});
		}

	}

	if (jQuery(".doc_addfav_btn").length > 0 && jQuery(".doc_addfav_btn .icons-svg").length) {
		if (jQuery(".doc_addfav_btn").find(".icons-svg").hasClass("icons-sprite-ico_addfav_red")) { //已收藏的，再点一下取消收藏
			jQuery(".doc_addfav_btn").find(".icons-svg").removeClass("icons-sprite-ico_addfav_red").addClass('icons-sprite-ico_addfav');
			jQuery(".doc_addfav_btn").find(".fun_name").html("收藏");
			jQuery.ajax({
				type: 'GET',
				url: "/app/my/bookshelf/delproduct.do?productid=" + pid + "&bookhouseid=1&t=" + new Date().getTime(),
				success: function (data) {
					if (data != null && data.code == 1) {
						console.log("取消收藏成功");
					}
					addDocToBookShopBtn.Ctrller = "true";
				}
			});
		} else { //未收藏，点击收藏
			jQuery(".doc_addfav_btn").find(".icons-svg").addClass("icons-sprite-ico_addfav_red").removeClass('icons-sprite-ico_addfav');
			jQuery(".doc_addfav_btn").find(".fun_name").html("已收藏");
			jQuery.ajax({
				type: 'GET',
				url: "/app/dwrutil/showFavoriteCode.do?from=newend&pid=" + pid + "&t=" + new Date().getTime(),
				success: function (data) {
					if (data != null && data.indexOf('div') > -1) {
						if (jQuery("#userfavoriteproductdiv") != null) {
							jQuery("#userfavoriteproductdiv").remove();
						}
						var oHtml = data;
						jQuery(document.body).append(oHtml);
						addDocToBookShopBtn.Ctrller = 'true';
					} else { //可以收藏
						jQuery.ajax({
							type: 'GET',
							url: "/newEnd/getUserFolders_New.do",
							context: document.body,
							data: "productId=" + pid + "&t=" + new Date().getTime(),
							success: function (data) {
								if (data) {
									jQuery('<div id="adFavWrap"></div>').appendTo(jQuery(this));
									var oHtml = data;
									var curScrollTop = 0;
									jQuery("#adFavWrap").append(oHtml);
									dialogBoxShadow();
									setObjCenter("selectFolder");
									if (jQuery("#folderUlBookhouse li.cur").hasClass("floder_forbid")) {
										curScrollTop = 0;
									} else {
										curScrollTop = jQuery("#folderUlBookhouse li.cur").position().top;
									}
									jQuery(".folder_box").scrollTop(curScrollTop);
									addDocToBookShopBtn.Ctrller = "true";
								}
							}
						});
					}
				}
			});
		}
	}
}
//付费阅读
function purchaseProduct(pid, uid, flag, isNewPop) {
	if (typeof isNewPop == 'undefined') {
		isNewPop = "2";
	}
	jQuery.ajax({
		type: 'GET',
		url: "/newEnd/purchaseProduct_new.do",
		async: false,
		context: document.body,
		data: "pid=" + pid + "&purchaserId=" + uid + "&flag=buy&isNewPop=" + isNewPop,
		success: function (data) {
			if (docinReader.config.isBuy == 1) {
				return false;
			}
			if (data) {
				var oHtml = data;
				jQuery(this).append(oHtml);
				if (isNewTradeProd != null && isNewTradeProd == "true") {
					window.location.reload();
					return;
				}
				closeDownLoadDiv('2');
				if ((typeof (idflag) != 'undefined') && idflag != "downLoadTips18") {
					dialogBoxShadow();
				}
				if (idflag != 'downLoadTips7') {
					setObjCenter(idflag);
				}
				if (idflag == "downLoadTips6") {
					//docinCopyData('share_copy','shareDocUrl');
				}
				if (idflag != 'downLoadTips1' && idflag != 'downLoadTips16') {
					// if(jQuery("#j_pay").length>0){
					// 	jQuery("#j_pay").removeClass('orange').addClass('gray').removeAttr('onclick');
					// 	jQuery("#j_pay").html('<span class="ico_mini ico_buy"></span>已付费'); 
					// }
					// if(jQuery("#j_pay_2").length>0){
					// 	jQuery("#j_pay_2 span").removeClass('tool_btn_org').addClass('tool_btn_gray').removeAttr('onclick');
					// 	jQuery("#j_pay_2 span").html('已付费');
					// }
					loadremaind(); //如果是付费阅读文档，加载剩下的
				}
			}
		}
	});
}

//购买付费+下载
function purchaseDownProduct(pid, uid, flag, isNewPop) {

	purchase(pid, uid, flag); //付费+下载 
}

//是否需要验证码
function isRequireCode(pid, uid, flag) {
	var random = new Date().getTime();
	jQuery.ajax({
		type: 'GET',
		url: "/newEnd/isHasCode.do",
		dataType: "html",
		async: false,
		context: document.body,
		data: "pid=" + pid + "&purchaserId=" + uid + "&datetime=" + random + "&flag=" + flag,
		success: function (data) {
			if (data) {
				//alert(data);
				if (data == 1) { //不需要
					purchase(pid, uid, flag);
				} else {
					closeDownLoadDiv(2);
					var oHtml = data;
					jQuery(this).append(oHtml);
					return;
				}
			}
		}
	});

}

//购买下载 免费不调 花钱调
function purchase(pid, uid, flag) {
	timerLoadingBeforeDownload = setTimeout(function(){
		console.log('loading...')
		showLoadingBeforeDownload(pid, '', 3, uid, flag);
		closeDownLoadDiv(2);
		closeDownLoadDiv(8);
		closeDownLoadDiv(9);
	}, 800);
	jQuery('#downLoadTips2-pay-btn').text('正在支付').css({padding: '0 12px'}).removeAttr('onclick');
	jQuery('#downLoadTips2-pay-btn-new').text('正在支付').removeAttr('onclick');
	jQuery('.downLoadTips8 .btn_blue').eq(0).text('正在支付').removeAttr('onclick');
	jQuery('.downLoadTips9 .btn_blue').eq(0).text('正在支付').removeAttr('onclick');
	console.log('initdownload purchase...')
	purchaseAjax(pid, uid, flag);
}
function purchaseAjax(pid, uid, flag){
	jQuery.ajax({
		type: 'POST',
		url: "/newEnd/purchaseProduct_new.do",
		dataType: "html",
		context: document.body,
		data: "pid=" + pid + "&purchaserId=" + uid + "&flag=" + flag,
		timeout: 8000,
		success: function (data) {
			closeDownLoadDiv('2');
			closeDownLoadDiv(8);
			closeDownLoadDiv(9);
			if (data) {
				var index = data.indexOf("1|");
				var index2 = data.indexOf("co188|");
				hideLoadingBeforeDownload();

				if (index == 0 || index2 == 0) { //文档可直接下载
					var downPath = data.split("|")[1];
					if ((typeof (down_flag) != 'undefined' && down_flag == 'contract')) {
						jQuery('body').append('<iframe style="display:none" id="iframe_data" src="' + downPath + '"></iframe>');
						return false;
					}

					if (index2 == 0) { //土木文档,直接下载,不需要进度条
						downloadSuccess(pid);
						jQuery('body').append('<iframe style="display:none" id="iframe_data" src="' + downPath + '"></iframe>');
						return false;
					}

					loadremaind(); //如果是付费阅读文档，加载剩下的

					downloadSuccess(pid);
					jQuery('body').append('<iframe style="display:none" id="iframe_data" src="' + downPath + '"></iframe>');
					return;

				}

				//付费下载调验证码
				if (data == "1" || data == "2") { //yidun
					loadremaind();
					showDownLoadSign(1, data, pid, "");
					return false;
				} else if (data == "3" || data == "4") { //docin 
					loadremaind();
					showDownLoadSign(2, data, pid, "");
					return false;
				}
			}
			//购买失败 继续走下载
			downLoadNew(pid, '');
		},
		error: function(error){
			loadingBeforeDownloadTimeoutStatus = true;
		}
	});
}
//加载 购买付费文档(弹窗)
function purchasePayProduct(pid, uid) {
	var random = new Date().getTime();
	jQuery.ajax({
		type: 'GET',
		async: false,
		dataType: "html",
		url: "/newEnd/buyPayProduct_temp.do",
		context: document.body,
		data: "pid=" + pid + "&purchaserId=" + uid + "&flag=buy&datetime=" + random,
		success: function (data) {
			if (data) {
				var oHtml = data;
				jQuery(this).append(oHtml);
				if (typeof (idflag) != 'undefined' && idflag == "") {
					return;
				}
				if ((typeof (idflag) != 'undefined') && idflag != "downLoadTips18" && idflag != "") {
					dialogBoxShadow();
				}
				setObjCenter(idflag);
				if (idflag == "downLoadTips1") {
					//下载、购买提示
					if (jQuery(".zk").length > 0) {
						jQuery(".zk").click(function () {
							var $index = jQuery(".zk").index(this);
							jQuery(".cz_btn").hide();
							jQuery(".cz_btn").eq($index).show();
							jQuery(".zk").show();
							jQuery(this).hide();
						});
					}
				}
			}
		}
	});
}
//关闭下载各种弹窗
function closeDownLoadDiv(id) {
	var oDownLoad = jQuery("#downLoadTips" + id);
	if (oDownLoad.length > 0) {
		oDownLoad.remove();
		dialogBoxHidden();
		if (id == 1) {
			var oVipTips = jQuery(".vipShowTips"),
				oDownTip5 = jQuery("#downLoadTips4");
			if (oDownTip5.length > 0 && oVipTips.length > 0) {
				oVipTips.remove();
				oDownTip5.remove();
			}
			if (typeof (wxpayTimer) != "undefined") {
				clearInterval(wxpayTimer);
				wxpayTimer = null;
			}
		}
	}
}
//以获取豆元继续支付
function showFin(flag) {
	closeDownLoadDiv("4");
	if (flag == "down") { //如果购买的是下载
		downLoadNew(tmp_product, '');
	} else if (flag == "print") {
		payForPint(product_id, isFreeDoc);
	} else if (flag == "convert") {
		payForConvert(product_id, isFreeDoc);
	} else { //购买的是付费
		purchasePayProduct(tmp_product, tmp_userId);
	}
}
//老购买弹层获取豆元
// function showGetDouyuan() {
// 	var getDouyuan = jQuery(".get_douyuan"),
// 		oBtnDy = jQuery("#dy");
// 	if (getDouyuan.length > 0 && oBtnDy.length > 0) {
// 		oBtnDy.bind('click', function () {
// 			getDouyuan.slideDown();
// 			jQuery(this).hide();
// 		});
// 	}
// }
//showGetDouyuan();

//顶
function checkTop(flag, url) {
	jQuery.ajax({
		url: url,
		success: function (data) {
			if (data == 1) { //可以顶
				if (flag == 1) { //顶
					if (jQuery("#showlab").length > 0) {
						var preNum = parseInt(jQuery("#showlab").html());
						jQuery("#showlab").html(preNum + 1);
					}
					if (jQuery("#topNum").length > 0) {
						var preNum = parseInt(jQuery("#topNum").html());
						jQuery("#topNum").html(preNum + 1);
						var left = parseInt(jQuery("#topNum").offset().left) + 10,
							top = 10,
							addP = jQuery('<div id="zhan"><b>+1<\/b></\div>').appendTo(jQuery(".docin_reader_tools"));
						jQuery('#zhan').css({
							'position': 'absolute',
							'z-index': '1',
							'color': '#2284e2',
							'left': left + 'px',
							'top': top + 'px'
						}).animate({
							top: top - 10,
							left: left + 10
						}, 'slow', function () {
							addP.fadeIn('fast').remove();
						});


					}
				} else if (flag == 2) {
					if (jQuery("#steponlab").length > 0) {
						var preNum = parseInt(jQuery("#steponlab").html());
						jQuery("#steponlab").html(preNum + 1);

						// var left = parseInt(jQuery("#top_hit").offset().left)+10,
						//  top = 10,
						//  addP = jQuery('<div id="zhan"><b>+1<\/b></\div>').appendTo(jQuery(".docin_reader_tools"));
						//  jQuery('#zhan').css({'position':'absolute','z-index':'1', 'color':'#2284e2','left':left+'px','top':top+'px'}).animate({top:top-10,left:left+10},'slow',function(){addP.fadeIn('fast').remove();});
					}
				}
			} else if (data == 0) { //顶过了
				alert('你已经投过票了，请不要重复投票');
			}
		}
	});
}



function setTop(productId, auditLevel) {
	/**
	 * 1 取出cookie_id的值
	 * 2 判断key = productId的这个cookie是否存在
	 * 3 比较两个值是否相等
	 */
	if (auditLevel != 1 && auditLevel != 20) {
		return;
	}
	var productIdValue = getCookie2008_1(productId);
	var cookieIdValue = getCookie2008_1("cookie_id");
	if (cookieIdValue == null) {
		alert("\u4f60\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301cookie\u529f\u80fd,\u8bf7\u786e\u8ba4!");
		return;
	}
	var url = "/jsp_cn/jquery/end/update_message.jsp?pid=" + productId + "&flag=top_new&date=" + new Date().getTime();
	if (productIdValue == null || productIdValue == "") { //没有顶过
		setCookie2008_1(productId, cookieIdValue, 60 * 24 * 365);
		checkTop(1, url);
		//jQuery("#a5").load(url);
	} else {
		if (productIdValue != cookieIdValue) { //该用户没有顶过
			setCookie2008_1(productId, cookieIdValue, 60 * 24 * 365);
			checkTop(1, url);
		} else {
			alert("\u4f60\u5df2\u7ecf\u6295\u8fc7\u7968\u4e86\uff0c\u8bf7\u4e0d\u8981\u91cd\u590d\u6295\u7968");
		}
	}
	shareEvent(productId, 14);
}

function zsetTop(productId, auditLevel) {
	/**
	 * 1 取出cookie_id的值
	 * 2 判断key = productId的这个cookie是否存在
	 * 3 比较两个值是否相等
	 */
	if (auditLevel != 1 && auditLevel != 20) {
		return;
	}
	var productIdValue = getCookie2008_1(productId);
	var cookieIdValue = getCookie2008_1("cookie_id");
	if (cookieIdValue == null) {
		alert("\u4f60\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301cookie\u529f\u80fd,\u8bf7\u786e\u8ba4!");
		return;
	}
	var url = "/bookshop/zsetTop.do?cid=" + productId;
	if (productIdValue == null || productIdValue == "") { //没有顶过
		setCookie2008_1(productId, cookieIdValue, 60 * 24 * 365);
		checkTop(1, url);
		//jQuery("#a5").load(url);
	} else {
		if (productIdValue != cookieIdValue) { //该用户没有顶过
			setCookie2008_1(productId, cookieIdValue, 60 * 24 * 365);
			checkTop(1, url);
		} else {
			alert("\u4f60\u5df2\u7ecf\u6295\u8fc7\u7968\u4e86\uff0c\u8bf7\u4e0d\u8981\u91cd\u590d\u6295\u7968");
		}
	}
	shareEvent(productId, 14);
}
//踩
function setStepon(productId, auditLevel) {
	if (auditLevel != 1 && auditLevel != 20) {
		return;
	}
	var productIdValue = getCookie2008_1(productId);
	var cookieIdValue = getCookie2008_1("cookie_id");
	if (cookieIdValue == null) {
		alert("\u4f60\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301cookie\u529f\u80fd,\u8bf7\u786e\u8ba4!");
		return;
	}
	var url = "/jsp_cn/jquery/end/update_message.jsp?pid=" + productId + "&flag=stepon_new&date=" + new Date().getTime();
	if (productIdValue == null) { //没有顶过
		setCookie2008_1(productId, cookieIdValue, 60 * 24 * 365);
		checkTop(2, url);
		//jQuery("#a5").load(url);
	} else {
		if (productIdValue != cookieIdValue) { //该用户没有顶过
			setCookie2008_1(productId, cookieIdValue, 60 * 24 * 365);
			checkTop(2, url);
			//jQuery("#a5").load(url);
		} else {
			alert("\u4f60\u5df2\u7ecf\u6295\u8fc7\u7968\u4e86\uff0c\u8bf7\u4e0d\u8981\u91cd\u590d\u6295\u7968");
		}
	}
}

function zsetStepon(productId, auditLevel) {
	if (auditLevel != 1 && auditLevel != 20) {
		return;
	}
	var productIdValue = getCookie2008_1(productId);
	var cookieIdValue = getCookie2008_1("cookie_id");
	if (cookieIdValue == null) {
		alert("\u4f60\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301cookie\u529f\u80fd,\u8bf7\u786e\u8ba4!");
		return;
	}
	var url = "/bookshop/zsetStepon.do?cid=" + productId;
	if (productIdValue == null) { //没有顶过
		setCookie2008_1(productId, cookieIdValue, 60 * 24 * 365);
		checkTop(2, url);
		//jQuery("#a5").load(url);
	} else {
		if (productIdValue != cookieIdValue) { //该用户没有顶过
			setCookie2008_1(productId, cookieIdValue, 60 * 24 * 365);
			checkTop(2, url);
			//jQuery("#a5").load(url);
		} else {
			alert("\u4f60\u5df2\u7ecf\u6295\u8fc7\u7968\u4e86\uff0c\u8bf7\u4e0d\u8981\u91cd\u590d\u6295\u7968");
		}
	}
}


/**********************登陆后调用 付费阅读 ************************/

//用户登录后付费阅读
function clickPayRead(pid, uid) {
	//先判断是否登陆
	if (isUserLogin == 0) {
		showPayReadLogin("payReadValue", "107_" + pid + "&registerFrom=1");
	} else {
		//加载付费阅读 弹窗
		purchasePayProduct(pid, uid);
	}

}

//用户登录后付费阅读（播放器下专用）  type:1付费  2下载
function clickPayRead_v2(pid, uid, type) {
	//先判断是否登陆
	if (isUserLogin == 0) {
		showPayReadLogin_v2(type, "&registerFrom=1");
	} else {
		if (type == 1) {
			//直接购买付费
			purchaseProduct(pid, uid, "buy", 1);
		} else {
			//直接购买下载
			purchaseDownProduct(pid, uid, "down", 1);
		}
	}

}

function showPayReadLogin(id, registerFrom) {
	if (typeof (id) == 'undefined' || id == null)
		return;

	var cook = new CookieClass();
	cook.expires = 10;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("payReadClickId", id);

	changeCookieValue(cook, "payReadClickId", registerFrom);
}

function showPayReadLogin_v2(type, registerFrom) {
	if (typeof (type) == 'undefined' || type == null)
		return;

	var cook = new CookieClass();
	cook.expires = 10;
	cook.domain = ".docin.com";
	cook.path = "/";

	if (type == 1) {
		cook.setCookie("payReadClickId_v2", "payReadValue_v2");
	} else {
		cook.setCookie("payReadClickId_v2", "payDownValue_v2");
	}
	changeCookieValue(cook, "payReadClickId_v2", registerFrom);

}

function showFeekLogin() {

	var cook = new CookieClass();
	cook.expires = 10;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("showFeekClickId", "showfeek");

	changeCookieValue(cook, "showFeekClickId");

}

//初始化付费阅读cookie   
function initPayRead() {

	var cook = new CookieClass();
	var remindClickId = cook.getCookie("payReadClickId");
	if (remindClickId == "payReadValue" && tmp_userId > 0) {
		if (iscanread == 0) {
			purchasePayProduct(tmp_product, tmp_userId);
		}
	}

	cook.expires = 1;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("payReadClickId", -1);
}

//初始化付费阅读cookie   
function initPayRead_v2() {

	var cook = new CookieClass();
	var remindClickId = cook.getCookie("payReadClickId_v2");
	if (remindClickId == "payReadValue_v2" && tmp_userId > 0) {
		if (iscanread == 0) {
			purchaseProduct(tmp_product, tmp_userId, "buy", 1);
		}
	} else if (remindClickId == "payDownValue_v2" && tmp_userId > 0) {
		//直接购买下载
		purchaseDownProduct(tmp_product, tmp_userId, "down", 1);
	}

	cook.expires = 1;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("payReadClickId_v2", -1);
}
/***********************************************/
//将不是cookie_id的cookie值变为-1
function changeCookieValue(cook, cookie_id, pid) {
	cook.expires = 1;
	cook.domain = ".docin.com";
	cook.path = "/";


	if (cookie_id != "downloadClickId_v2") {
		cook.setCookie("downloadClickId_v2", -1);
	}

	if (cookie_id != "remindClickId") {
		//将豆单的cookie变为-1
		cook.setCookie("remindClickId", -1);
	}

	if (cookie_id != "booksaveClickId") {
		//收藏
		cook.setCookie("booksaveClickId", -1);
	}

	if (cookie_id != "downloadClickId") {
		//下载
		cook.setCookie("downloadClickId", -1);
	}

	if (cookie_id != "payReadClickId") {
		//付费阅读
		cook.setCookie("payReadClickId", -1);
	}

	if (cookie_id != "showFeekClickId") {
		//举报
		cook.setCookie("showFeekClickId", -1);
	}

	if (cookie_id != "vip_alert_adv") {
		//相关文档 关闭广告
		cook.setCookie("vip_alert_adv", -1);
	}

	if (cookie_id != "can_copy_alert") {
		//播放器复制
		cook.setCookie("can_copy_alert", -1);
	}

	if (cookie_id != "partnerLogin") {
		//投资文档
		cook.setCookie("partnerLogin", -1);
	}
	if (cookie_id != "print_login" + tmp_product) {
		//投资文档
		cook.setCookie("print_login" + tmp_product, -1);
	}
	if (cookie_id != "convert_login" + tmp_product) {
		//格式转换
		cook.setCookie("convert_login" + tmp_product, -1);
	}

	showlogin(pid);

}


/*****************  登陆后调用 下载   ************/
function showDownloadLogin(id, pid) {
	if (typeof (id) == 'undefined' || id == null)
		return;
	var cook = new CookieClass();
	cook.expires = 10;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("downloadClickId", id);
	changeCookieValue(cook, "downloadClickId", pid);
}

function showPrintLogin(id, pid) {
	if (typeof (id) == 'undefined' || id == null)
		return;
	var cook = new CookieClass();
	cook.expires = 10;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("print_login" + tmp_product, "1");
	changeCookieValue(cook, "print_login" + tmp_product, pid);
}
// 登录后调用 格式转换
function showConvertLogin(id, pid) {
	if (typeof (id) == 'undefined' || id == null)
		return;
	var cook = new CookieClass();
	cook.expires = 10;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("convert_login" + tmp_product, "1");
	changeCookieValue(cook, "convert_login" + tmp_product, pid);
}

//用户登录后下载
function clickDownload(pid, fn, source) {
	if (testIE8()) {
		var ie8ExploerTips = new CreateDocinDialog({
			id: "ieExploertips",
			cls: "ieExploertips",
			title: "温馨提示",
			content: '<p style="font-size:14px;line-height:26px;margin-bottom:25px;">当前的浏览器版本过低，存在安全风险，<b>可能导致无法正常下载文档</b><br/>您可以选择以下浏览器进行下载升级，或使用其它浏览器访问网站。</p><p class="exploer_item"><a href="http://dl.pconline.com.cn/download/63040.html" target="_blank"><span class="ico_chrome"></span>[下载]&nbsp;谷歌浏览器</a><a href="http://www.firefox.com.cn/download/" target="_blank"><span class="ico_firefox"></span>[下载]&nbsp;火狐浏览器</a><a href="http://www.uc.cn/" target="_blank"><span class="ico_uc"></span>[下载]&nbsp;UC浏览器</a></p>',
			cancel: {
				txt: "我知道了",
				value: true
			},
			confirm: {
				txt: "暂不升级，继续下载文档",
				value: true
			},
			callBack: {
				okBack: function () { //先判断是否登陆
					if (isUserLogin == 0) {
						//没登录过记录hyd的终极页注册需求
						if (!pid) {
							showDownloadLogin("downloadValue", null);
						} else {
							showDownloadLogin("downloadValue", "106_" + pid + "&registerFrom=1");
							//showDownloadLogin("downloadValue",null);
						}
					} else {
						downLoadNew(pid, fn);
					}
					return true;
				},
				noBack: function () {
					ie8ExploerTips = null;
					return false;
				}
			}
		});
		return false;
	}

	//先判断是否登陆
	if (isUserLogin == 0) {
		//没登录过记录hyd的终极页注册需求
		if (!pid) {
			showDownloadLogin("downloadValue", null);
		} else {
			var build_type = "false";
			if (typeof (readerConfig) != "undefined" && readerConfig.isDocin != undefined) {
				build_type = readerConfig.isDocin + '';
			}
			jQuery.ajax({
				type: 'GET',
				url: "/newEnd/isAlertLoginLayer.do",
				context: document.body,
				data: "pid=" + tmp_product + "&fn=" + fn + "&build_type=" + build_type,
				single: 'loginLayer',
				success: function (data) {
					if (data) {
						if (data != "-1") { //未登录时,游客购买
							var oHtml = data;
							jQuery(this).append(oHtml);
							dialogBoxShadow();
							setObjCenter("quickDown");
							lastLoginTips(1);
						} else { //普通登录框
							showDownloadLogin("downloadValue", "106_" + pid + "&registerFrom=1");
						}
					}
				}
			});
		}
	} else {
		timerLoadingBeforeDownload = setTimeout(function(){
			console.log('loading...')
			if (source && source == 'pay') {
				showLoadingBeforeDownload(pid, fn, 1);
			} else {
				showLoadingBeforeDownload(pid, fn);
			}
		}, 800);
		console.log('clickDownload downLoadStart...')
		downLoadNew(pid, fn);
	}
}
//初始化下载cookie   
function initdownload() {
	//登录前下载初始化Cookie 登陆后调用
	var cook = new CookieClass();
	var remindClickId = cook.getCookie("downloadClickId");
	if ((remindClickId == "downloadValue" && tmp_userId > 0) || (typeof reDownload != 'undefined' && reDownload == 1)) {
		timerLoadingBeforeDownload = setTimeout(function(){
			console.log('loading...')
			showLoadingBeforeDownload(tmp_product, isFreeDoc);
		}, 800);
		console.log('initdownload loading前置 downLoadStart...')
		downLoadNew(tmp_product, isFreeDoc);
	}

	cook.expires = 1;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("downloadClickId", -1);
}

/***************   结束   **************/

/*********** 登录后调用投资文档 *************/

function partnerLogin(pid) {

	var cook = new CookieClass();
	cook.expires = 10;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("partnerLogin", 1);
	changeCookieValue(cook, "partnerLogin", 1);

}

function initPartner() {

	var cook = new CookieClass();
	var remindClickId = cook.getCookie("partnerLogin");
	if (remindClickId == 1 && tmp_userId > 0) {
		jQuery("#partnerEntr").click();
	}

	cook.expires = 1;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("partnerLogin", -1);
}





/***************** 终极页 登陆后 调用 收藏***********************/
function showBookSaveLogin(id, pid) {
	if (typeof (id) == 'undefined' || id == null)
		return;
	var cook = new CookieClass();
	cook.expires = 10;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("booksaveClickId", id);

	changeCookieValue(cook, "booksaveClickId", pid);
}

//用户登录后收藏
function clickBookSave(pid) {
	//先判断是否登陆
	if (isUserLogin == 0) {
		//没登录过记录hyd的终极页注册需求
		if (!pid) {
			showBookSaveLogin("booksaveValue", null);
		} else {
			showBookSaveLogin("booksaveValue", "105_" + pid + "&registerFrom=1");
		}
	} else {
		addDocToBookshop(pid);
	}

}
//初始化收藏cookie   
function initbooksave() {

	var cook = new CookieClass();
	var remindClickId = cook.getCookie("booksaveClickId");
	if (remindClickId == "booksaveValue" && tmp_userId > 0) {
		addDocToBookshop(tmp_product);
	}

	cook.expires = 1;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("booksaveClickId", -1);
}

function initPrint(pid) {
	var cook = new CookieClass();
	var print_login = cook.getCookie("print_login" + tmp_product);
	// cook.setCookie("print_login" + tmp_product, -1);
	if (print_login == "1" && tmp_userId > 0) {
		if (jQuery("#j_print,.doc_print_btn").length > 0) {
			jQuery("#j_print,.doc_print_btn").trigger("click");
		}

	} else if (print_login == "2" && tmp_userId > 0 && window.location.href.indexOf("isPay") > 0) {
		if (jQuery("#j_print,.doc_print_btn").length > 0) {
			jQuery("#j_print,.doc_print_btn").trigger("click");
		}
	}
	// delete printCookie 
	cook.deleteCookie("print_login" + tmp_product);
}

/***************** 结束 ***********************/



//用户登录后加入豆单
function initInsertDoclist(pid) {

	var cook = new CookieClass();
	var remindClickId = cook.getCookie("remindClickId");
	if (remindClickId == "insertDoclist" && tmp_userId > 0) {
		insertDoclist(pid);
	}

	cook.expires = 1;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("remindClickId", -1);
}

//终极页加入豆单按钮
function insertDoclist(pid) {

	if (isZuZhi == "1") {
		mailDialogAlert(login_email, landingEmail, domailUrl)
		return;
	}

	//请求载入提示层
	var doudanUrl = "/jsp_cn/productEnd/ajax/doclist_pop_new.jsp?random=" + Math.round(Math.random() * 100);
	if (tmp_userId > 0) {
		jQuery.ajax({
			type: "POST",
			url: doudanUrl,
			data: "productid=" + pid,
			async: false,
			success: function (re) {
				if (re) {
					if (jQuery("#doudanRelative").length == 0) {
						jQuery("<div id=\"doudanRelative\"></div>").appendTo(document.body);
					}
					var popTmp = jQuery("#doudanRelative");
					popTmp.html(re);
					dialogBoxShadow();
				}
			}
		});
	}
	//发送ajax请求  判断用户是否创建过豆单
	var url = "/my/docin/doclist/insertdoclist.do?random=" + Math.round(Math.random() * 100);
	jQuery.post(url, null, function (data) {
		if (data != null) {
			var json = eval("(" + data + ")");
			var result = json.result;
			if (result == 0) {
				//未登录 弹出登陆框
				showLoginAndClick("insertDoclist");
			} else {
				if (result == 1) {
					//已登录 没有豆单
					var oCreateDiv = document.getElementById("createDoudan");
					setAlertCenter(oCreateDiv);
				} else {
					if (result == 2) {
						//已登录 有豆单
						var doclist = json.doclist;
						if (doclist != null) {
							document.getElementById("doclistEndUL").innerHTML = "";
							for (var dl in doclist) {
								var id = doclist[dl].id;
								var title = doclist[dl].title;
								if (title != undefined) {
									var n = document.createElement("li");
									n.innerHTML = "<input type='radio' name='doclistEndId' value='" + id + "' /><label>" + title + "</label>";
									document.getElementById("doclistEndUL").appendChild(n);
								}
							}
							var n2 = document.createElement("li");
							document.getElementById("doclistEndUL").appendChild(n2);
							var n1 = document.createElement("li");
							var url = "/app/my/docin/doclist/createdoclist";
							if (document.getElementById("productId") != null) {
								var productId = document.getElementById("productId").value;
								url = "/app/my/docin/doclist/createdoclist?pid=" + productId;
							}
							n1.style.fontSize = 14 + "px";
							n1.innerHTML = "\u76ee\u524d\u6ca1\u6709\u9002\u5408\u7684\u8c46\u5355,<a target='_blank' onclick='displayNoneAddDoudan();' href='" + url + "'>\u521b\u5efa\u8c46\u5355</a>";
							document.getElementById("doclistEndUL").appendChild(n1);
							var oAddDiv = document.getElementById("addDoudan");
							setAlertCenter(oAddDiv);
						}
					}
				}
			}
		}
	});
}

function displayNoneAddDoudan() {

	document.getElementById('addDoudan').style.display = 'none';
	dialogBoxHidden();

}

function addProduct2Doclist() {

	var productId = document.getElementById("doclistProductId").value;

	var doclistEnd = document.getElementsByName("doclistEndId");

	var doclistId;

	var i = 0;

	for (i = 0; i < doclistEnd.length; i++)

	{

		if (doclistEnd.item(i).checked)

		{

			doclistId = doclistEnd.item(i).getAttribute("value");

			break;

		}

	}
	closeDialogDiv('addDoudan', 1);

	var url = "/my/docin/doclist/adddoclistend.do?random=" + Math.round(Math.random() * 100) + "&productid=" + productId + "&doclistid=" + doclistId;

	jQuery.post(url, null, function (data) {

		if (data != null) {

			if (data == 1) {
				dialogBoxShadow();
				var oAddOkDiv = document.getElementById('addOk');

				setAlertCenter(oAddOkDiv);

				//2秒后 关闭弹出层

				setTimeout(function test() {
					closeDialogDiv('addOk', 1);
				}, 2000);

			}

		}

	});

}

//弹出层绝对居中定位
function setAlertCenter(obj) {
	if (!obj) {
		return false;
	}
	var d = document;
	obj.style.display = "block";
	var data = {
		ow: obj.clientWidth,
		oh: obj.clientHeight,
		vw: (function () {
			if (d.compatMode == "BackCompat") {
				return d.body.clientWidth;
			} else {
				return d.documentElement.clientWidth;
			}
		})(),
		vh: (function () {
			if (d.compatMode == "BackCompat") {
				return d.body.clientHeight;
			} else {
				return d.documentElement.clientHeight;
			}
		})(),
		st: (d.body.scrollTop || d.documentElement.scrollTop)
	};
	obj.style.left = (data.vw - data.ow) / 2 + "px";
	obj.style.margin = 0;
	obj.style.position = "absolute";
	obj.style.top = (data.vh - data.oh) / 2 + data.st + "px";
}
//举报
function showFeekback(obj, elem) {
	var d = document,
		o = d.getElementById(obj),
		s = d.getElementById(elem);
	if (!o || !s) {
		return false;
	}
	s.onclick = function () {
		var sObj = new getXYWH(this);
		_left = (sObj.showL > 800) ? ("right:68px;") : ("left:" + (sObj.showL) + "px;");
		o.style.cssText = ";top:" + (sObj.showT + 25) + "px;" + _left;
		if (elem == "recommendMessageButtun") {
			var productId = d.getElementById("productId").value;
			var sendUrl = "/app/jquery/isRecommendProduct?pid=" + productId + "&rand=" + new Date().getTime();
			var result = trim(jQuery.ajax({
				url: sendUrl,
				async: false
			}).responseText);
			alert(result);
			if (result == "true") {
				d.getElementById("feekBackDiv").style.display = "block";
				d.getElementById("recommendedMessageDiv").style.display = "block";
				d.getElementById("reportMessageDiv").style.display = "none";
			} else {
				d.getElementById("recommendedMessageDiv").style.display = "none";
				d.getElementById("reportMessageDiv").style.display = "none";
				jQuery("#jquerydiv").load("/app/jquery/mingrenrecom?pid=" + productId + "&date=" + new Date().getTime());
			}
		} else {
			d.getElementById("feekBackDiv").style.display = "block";
			d.getElementById("recommendedMessageDiv").style.display = "none";
			d.getElementById("reportMessageDiv").style.display = "block";
		}
	};
}

function hiddenFeekback() {
	var d = document;
	// d.getElementById("subTip").innerHTML = "\u8f93\u5165\u4e0e\u4e4b\u91cd\u590d\u7684\u53e6\u4e00\u7bc7\u6587\u6863URL\u5730\u5740";
	// d.getElementById("subTip").style.color = "#000";
	// d.getElementById("purl").value = "";
	d.getElementById("feekBackDiv").style.display = "none";
}

//发送举报消息（新）
function feekSubmit(id) {
	var doc = document;
	var content = doc.getElementById("error3").value; //举报内容
	var type = 2; //举报类型

	if (doc.getElementById("error6").checked) { // 举报该文档为侵权文档。
		type = type + 11;
		content == "" ? doc.getElementById("error6").value : content;
	} else if (doc.getElementById("error1").checked) { // 举报该文档含有违规或不良信息。
		type = type + 3;
		content == "" ? doc.getElementById("error1").value : content;
	} else if (doc.getElementById("error4").checked) { // 反馈该文档无法正常浏览。
		type = type + 4;
		content == "" ? doc.getElementById("error4").value : content;
	} else if (doc.getElementById("error2").checked) { // 举报该文档为重复文档。
		type = type + 5;
		content = doc.getElementById("purl").value; //输入的url

		if (content == "" || content.length < 1) { //输入url内容为空
			showFeekError("请输入与本篇重复的文档网址");

			return;
		} else { //输入url不为空
			var begin = content.indexOf("-");
			var end = content.lastIndexOf(".html");
			if (begin == -1 || end == -1) { //输入格式不正确
				showFeekError("请输入正确的网址<br />如：http://www.docin.com/p-23020082.html");

				return;
			} else {

				var reg = new RegExp("^[0-9]*$");
				var jbid = content.substring(begin + 1, end);
				if (!reg.test(jbid)) {
					showFeekError("请输入正确的网址<br />如：http://www.docin.com/p-23020082.html");

					return;
				} else if (parseInt(jbid) > parseInt(id)) { //输入的文档上传时间在举报文档上传时间之后 
					showFeekError("您的举报无效，请核实举报文档的上传时间");

					return;
				} else if (parseInt(jbid) == parseInt(id)) { //输入文档与举报文档为同一文档
					showFeekError("输入文档链接有误，不能举报同一篇文档");

					return;
				}
			}
		}
	} else {
		alert("请您选择举报类型！");

		return;
	}

	var url = "/jsp_cn/jquery/end/update_message.jsp?content=" + encodeURI(content) + "&pid=" + id + "&type=" + type + "&flag=sendFeekBack&date=" + new Date().getTime();
	jQuery("#a5").load(url);

}

//显示举报错误信息
function showFeekError(msg) {
	if (jQuery("#feekTips").length > 0) {
		jQuery("#feekTips").html(msg);
		jQuery("#feekTips").show();
	} else {
		jQuery('<p id="feekTips" class="fcr">' + msg + '</p>').insertAfter(jQuery("#repeatproduct"));
	}
}


//发送举报消息
function sendFeekBack(id) {
	var d = document,
		content = "",
		type = 2,
		errs = "";
	var error3 = d.getElementById("error3").value;
	if (error3 == "") { //没有填写举报内容testarea
		if (d.getElementById("error1").checked) {
			type = type + 3;
			content = d.getElementById("error1").value;
		} else if (d.getElementById("error6").checked) { //举报该文档为侵权文档
			type = type + 11;
			content = d.getElementById("error6").value;
		} else {
			if (d.getElementById("error2").checked) {
				type = type + 5;
				//content = d.getElementById("error2").value;
				content = d.getElementById("purl").value;
				if (content == "" || content.length < 1) {
					if (jQuery("#feekTips").length > 0) {
						jQuery("#feekTips").html("请输入与本篇重复的文档网址");
						jQuery("#feekTips").show();
					} else {
						jQuery('<p id="feekTips" class="fcr">请输入与本篇重复的文档网址</p>').insertAfter(jQuery("#repeatproduct"));
					}
					return;
				} else {
					var begin = content.indexOf("-");
					var end = content.lastIndexOf(".html");
					if (begin == -1 || end == -1) {
						if (jQuery("#feekTips").length > 0) {
							jQuery("#feekTips").html("请输入正确的网址<br />如：http://www.docin.com/p-***.html");
							jQuery("#feekTips").show();
						} else {
							jQuery('<p id="feekTips" class="fcr">请输入正确的网址<br />如：http://www.docin.com/p-***.html</p>').insertAfter(jQuery("#repeatproduct"));
						}
						return;
					} else {
						var jbid = content.substring(begin + 1, end);
						if (parseInt(jbid) > parseInt(id)) {
							if (jQuery("#feekTips").length > 0) {
								jQuery("#feekTips").html("您的举报无效，请核实举报文档的上传时间");
								jQuery("#feekTips").show();
							} else {
								jQuery('<p id="feekTips" class="fcr">您的举报无效，请核实举报文档的上传时间</p>').insertAfter(jQuery("#repeatproduct"));
							}
							//alert("\u60a8\u7684\u4e3e\u62a5\u65e0\u6548\uff0c\u8bf7\u6838\u5b9e\u4e3e\u62a5\u6587\u6863\u7684\u4e0a\u4f20\u65f6\u95f4");
							return;
						} else {
							if (parseInt(jbid) == parseInt(id)) {
								if (jQuery("#feekTips").length > 0) {
									jQuery("#feekTips").html("输入文档链接有误，不能举报同一篇文档");
									jQuery("#feekTips").show();
								} else {
									jQuery('<p id="feekTips" class="fcr">输入文档链接有误，不能举报同一篇文档</p>').insertAfter(jQuery("#repeatproduct"));
								}
								return;
							}
						}
					}
				}
			} else {
				if (d.getElementById("error4").checked) {
					type = type + 4;
					content = d.getElementById("error4").value;
				} else {
					if (d.getElementById("error5").checked) {
						type = type + 2;
						content = d.getElementById("error5").value;
						var mes = document.getElementsByName("errors");
						for (var i = 0; i < mes.length; i++) {
							if (mes[i].checked) {
								content = content + mes[i] + " ";
							}
						}
					} else {
						alert("\u8bf7\u6dfb\u5199\u6216\u9009\u62e9\u4e3e\u62a5\u4fe1\u606f!");
						return;
					}
				}
			}
		}
	} else {
		content = error3;
		if (d.getElementById("error2").checked) {
			type = type + 5;
			//content = d.getElementById("error2").value;
			content = d.getElementById("error3").value;
			if (content == "" || content.length < 1 || content == "\u8f93\u5165\u4e0e\u4e4b\u91cd\u590d\u7684\u53e6\u4e00\u7bc7\u6587\u6863URL\u5730\u5740") {
				alert("\u8bf7\u8f93\u5165\u91cd\u590d\u6587\u6863!");
				return;
			} else {
				var begin = content.indexOf("-");
				var end = content.lastIndexOf(".html");
				if (begin == -1 || end == -1) {
					alert("\u8f93\u5165\u6b63\u786e\u7f51\u5740");
					return;
				} else {
					var jbid = content.substring(begin + 1, end);
					if (parseInt(jbid) > parseInt(id)) {
						alert("\u60a8\u7684\u4e3e\u62a5\u65e0\u6548\uff0c\u8bf7\u6838\u5b9e\u4e3e\u62a5\u6587\u6863\u7684\u4e0a\u4f20\u65f6\u95f4");
						return;
					} else {
						if (parseInt(jbid) == parseInt(id)) {
							d.getElementById("subTip").innerHTML = "\u8f93\u5165\u6587\u6863\u94fe\u63a5\u6709\u8bef\uff0c\u4e0d\u80fd\u4e3e\u62a5\u540c\u4e00\u7bc7\u6587\u6863\uff01";
							d.getElementById("subTip").style.color = "#f00";
							return;
						}
					}
				}
			}
		}
	}
	var url = "/jsp_cn/jquery/end/update_message.jsp?content=" + encodeURI(content) + "&pid=" + id + "&type=" + type + "&flag=sendFeekBack&date=" + new Date().getTime();
	jQuery("#a5").load(url);
}
//举报弹层
function changeRadio() {
	var d = document;
	var obj = jQuery("#error2");
	if (obj.length > 0) {
		jQuery("#purl").val("");
		if (obj.prop("checked")) {
			jQuery("#repeatproduct").show();
		} else {
			if (jQuery('#feekTips').length > 0) {
				jQuery("#feekTips").hide();
			}
			jQuery("#repeatproduct").hide();
		}
	}
}

function showFeek() {
	var d = document,
		o = d.getElementById("feekBackDiv"),
		s = d.getElementById("feekback1");
	if (!o || !s) {
		return false;
	}
	var sObj = new getXYWH(s);
	//_left = (sObj.showL > 800) ? ("right:68px;") : ("left:" + (sObj.showL) + "px;");
	_left = ("left:" + (sObj.showL) + "px;");
	o.style.cssText = ";top:" + (sObj.showT + 25) + "px;" + _left;
	d.getElementById("feekBackDiv").style.display = "block";
	d.getElementById("recommendedMessageDiv").style.display = "none";
	d.getElementById("reportMessageDiv").style.display = "block";

}

function isShowFeek() {

	if (isUserLogin == 0) { //用户未登录

		showFeekLogin();

	} else {
		showFeek();
	}

}

/***************************登录后弹出举报单层*****************************/

//初始化举报cookie   
function initshowfeek() {

	var cook = new CookieClass();
	var remindClickId = cook.getCookie("showFeekClickId");
	if (remindClickId == "showfeek" && tmp_userId > 0) {
		setTimeout(function () {
			jQuery("#feekback1").trigger("click");
		}, 2000);
	}

	cook.expires = 1;
	cook.domain = ".docin.com";
	cook.path = "/";
	cook.setCookie("showFeekClickId", -1);
}

/***************************登录后弹出举报单层*****************************/
//终极页二维码用  start  -----
function showDimCodeDiv(window) {
	var feekDimcCode = document.getElementById("feekDimcCode"),
		dimCodeDiv = document.getElementById("dimCodeDiv"),
		docinIcon = document.getElementById("dimcode_docin_icon"),
		dimPic = document.getElementById("dimcode_pic");
	if (!feekDimcCode || !dimCodeDiv) {
		return;
	}
	var isDocerFlag = "";
	if (typeof (isDocer) != "undefined" && isDocer == 1) {
		isDocerFlag = "&unsupport=1";
	}
	feekDimcCode.onclick = function () {
		var l = getDistance(this)[0];
		var t = getDistance(this)[1];
		dimCodeDiv.style.left = l + 'px';
		dimCodeDiv.style.top = t + 28 + 'px';
		var doc_url = window.location.href;
		//处理分节阅读url
		var indexof_html = doc_url.indexOf(".html", 0);
		var end = doc_url.substring(indexof_html, doc_url.length);
		var tmp = doc_url.substring(0, indexof_html);
		var start = tmp.substring(0, tmp.indexOf("_", 0) > 0 ? tmp.indexOf("_", 0) : tmp.length);
		start = start.substring(0, start.indexOf("-f", 0) > 0 ? start.indexOf("-f", 0) : start.length)
		doc_url = start + end;
		doc_url = doc_url.replace(/&/, "%26");
		if (typeof readerConfig != 'undefined') {
			if (typeof readerConfig.appCanRead != 'undefined') {
				doc_url += "&payMode=" + readerConfig.appCanRead;
			}
		}
		dimPic.src = "/servlet/get2wm?doc_end_url=" + doc_url + isDocerFlag;
		dimCodeDiv.style.display = "block";
		inpmv(4457);
	};
	dimPic.onload = function () {
		docinIcon.style.display = "block";
	}

	function closeDimDiv() {
		dimCodeDiv.style.display = "none";
		//非pc端购买打9折
		if (jQuery("#dialogBoxShadow").length > 0 && jQuery("#dialogBoxShadow").is(':visible')) {
			if (jQuery("#downLoadTips1").length > 0) {
				setObjCenter('downLoadTips1');
			}
		}
	}
	window.closeDimDiv = closeDimDiv;
}
(function () {
	showDimCodeDiv(window); //显示二维码
	//showGetDouyuan();//获取豆元渠道
})();

function getDistance(obj) {
	var left = 0,
		top = 0;
	while (obj.offsetParent) {
		left += obj.offsetLeft;
		top += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return [left, top];
}
//获取豆元
// function showGetDouyuan() {
// 	var getDouyuan = jQuery(".get_douyuan"),
// 		oBtnDy = jQuery("#dy");
// 	if (getDouyuan.length > 0 && oBtnDy.length > 0) {
// 		oBtnDy.bind('click', function () {
// 			getDouyuan.slideDown();
// 			jQuery(this).hide();
// 			jQuery("#dh").hide();
// 		});
// 	}
// }
var docinClipboard = null;
var shareFlag = 0;
var jubaoFlag = 0;

function docinCopyData(handlerId, infoDataId, f) {
	if (f == 1 && shareFlag == 1) {
		return;
	}
	if (f == 2 && jubaoFlag == 1) {
		return;
	}
	if (testIE8()) {
		var clip = "clip" + handlerId;
		clip = new ZeroClipboard.Client();
		clip.setHandCursor(true);
		clip.addEventListener('mouseOver', function (client) {
			var oText = jQuery('#' + infoDataId);
			clip.setText(oText.val());
			oText.select();
		});
		clip.addEventListener('complete', function (client, text) {
			alert("内容已经复制，你可以使用Ctrl+V 粘贴。");
			console.log(client)
			console.log("flash");
		});
		clip.glue(handlerId);
		return;
	}
	docinClipboard = new ClipboardJS("#" + handlerId, {
		text: function () {
			return jQuery('#' + infoDataId).val();
		}
	});
	docinClipboard.on('success', function (e) {
		// console.log(e)
		alert("内容已经复制，你可以使用Ctrl+V 粘贴。");
		console.log("这个复制不是flash");
		if (e.trigger.id == 'docUrl') {
			inpmv(7915);
		} else if (e.trigger.id == 'flashUrl') {
			inpmv(7916);
		} else if (e.trigger.id == 'embedTxt') {
			inpmv(7917 );
		}
		e.clearSelection();
	});
	docinClipboard.on('error', function (e) {
		console.log("copy error!");
	});

}

function openDocinshare(n) { //参数n  1：人人 2：QQ空间 3：新浪微博 4：腾讯微博 5：QQ好友 6：开心网
	if (!bdshareconfig) {
		return;
	}
	switch (n) {
		case 1:
			bdshareconfig.to = "renren";
			renrenBdShare(js_pid, js_cid);
			break;
		case 2:
			bdshareconfig.to = "qzone";
			qqZoneBdShare(js_pid, js_cid);
			break;
		case 3:
			bdshareconfig.to = "tsina";
			sinaWbBdShare(js_pid, js_cid);
			break;
		case 4:
			bdshareconfig.to = "tqq";
			qqWbBdShare(js_pid, js_cid);
			break;
		case 5:
			bdshareconfig.to = "sqq";
			qqFdBdShare(js_pid, js_cid);
			break;
		case 6:
			bdshareconfig.to = "kaixin001";
			kaixinBdShare(js_pid, js_cid);
			break;
		default:
			return;
	}
	var shareUrl = 'http://s.share.baidu.com/?click=1&url=' + bdshareconfig.url + '&uid=&to=' + bdshareconfig.to + '&type=text&pic=' + bdshareconfig.pic + '&title=' + bdshareconfig.title + ' &key=&sign=on&desc=' + bdshareconfig.desc + '&comment=' + bdshareconfig.desc + '&searchPic=1&l=181b8ivcl181b8j0c5181b8jelv&linkid=hk1wfrmedvq&sloc=674.301.0.28.35.20.28.36.37.0.961&apiType=0&buttonType=0&firstime=1372954734986'
	window.open(shareUrl);
}


function closeDialogDiv(id, f) {
	jQuery("#" + id).remove();
	if (id == "docinPopBox1") {
		if (jQuery("#docUrl_copyclick").length > 0) {
			jQuery("#docUrl_copyclick").remove();
		}
		if (jQuery("#flashUrl_copyclick").length > 0) {
			jQuery("#flashUrl_copyclick").remove();
		}
		if (jQuery("#embedTxt_copyclick").length > 0) {
			jQuery("#embedTxt_copyclick").remove();
		}
		if (typeof (docinClipboard) != "undefined") { //清除复制对象
			docinClipboard.destroy();
		}
	}
	if (f) {
		dialogBoxHidden();
	}
}

function closeOpenShare(id) {
	jQuery("#" + id).hide();
	dialogBoxHidden();
	if (jQuery("#docUrl_copyclick").length > 0) {
		jQuery("#docUrl_copyclick").remove();
	}
	if (jQuery("#flashUrl_copyclick").length > 0) {
		jQuery("#flashUrl_copyclick").remove();
	}
	if (jQuery("#embedTxt_copyclick").length > 0) {
		jQuery("#embedTxt_copyclick").remove();
	}
}

function changeSize(url, w, h, obj) {
	var str = '<embed src="' + url + '" width="' + w + '" height="' + h + '" type="application/x-shockwave-flash" ALLOWFULLSCREEN="true" ALLOWSCRIPTACCESS="always"></embed>';
	jQuery("#endShareCode").val(str);
	var aLI = jQuery('#b_size a');
	if (aLI.length > 0) {
		aLI.removeClass('cur');
		jQuery(obj).addClass('cur');
	}
}

function showReportDiv() {
	dialogBoxShadow();
	setObjAbsoluteCenter('feekBackDiv');
}

function gotoCreateDoudan() {
	var oDoudanRelativeDiv = jQuery("#doudanRelative");
	if (oDoudanRelativeDiv.length > 0) {
		oDoudanRelativeDiv.remove();
		dialogBoxHidden();
	}
}

function startTime(id, h, m, s, from) {
	var _t = null;
	clearTimeout(_t);
	var _v = '距离免费结束还有：';
	if (from == 'index_after') {
		_v = "免费结束：";
	}
	if (from == 'index' && id == 'oTime') {
		_v += "<br />";
	}
	_v += h + '小时' + m + '分' + s + '秒';
	var oTimebox = document.getElementById(id);
	if (oTimebox) {
		oTimebox.innerHTML = _v;
	}
	_t = setTimeout('doTime(\'' + id + '\',' + h + ' , ' + m + ' , ' + s + ' , \'' + from + '\')', 1000);
}

//aliyun fangqueue -- 
function alivisit(productid) {
	if (productid != null) {
		jQuery.get("/app/aliv/aliv.do", {
			p: productid
		});
	}
}

function alivisit_2014(productid) {
	if (productid != null) {
		jQuery.get("/app/aliv/aliv_2014.do", {
			p: productid
		});
	}
}

function end_doc_visit(productid) {
	if (productid != null) {
		jQuery.get("/app/aliv/docvisit.do", {
			p: productid
		});
	}
}
//aliyun fangqueue -- 

function showMessageContent() {
	var cpage = jQuery("#msgcpage").val(),
		pid = jQuery("#productId").val(),
		total = jQuery("#total").val(),
		userIp = jQuery("#userIp").val(),
		isMy = jQuery("#ismy").val();
	if (isMy == "") {
		isMy = 0;
	}
	var url = "/jsp_cn/jquery/end/message_new.jsp?page=" + cpage + "&pid=" + pid + "&ism=" + isMy + "&to=" + total + "&userIp=" + userIp + "&date=" + new Date().getTime();
	jQuery("#showMsgContent").load(url);
}

function showMessageU(currentPage) {
	var cpage = currentPage,
		pid = jQuery("#productId").val(),
		total = jQuery("#total").val(),
		isMy = jQuery("#ismy").val();
	if (isMy == "") {
		isMy = 0;
	}
	var url = "/jsp_cn/jquery/end/message_new.jsp?page=" + cpage + "&pid=" + pid + "&ism=" + isMy + "&to=" + total + "&date=" + new Date().getTime();
	jQuery("#showMsgContent").load(url);
}
//留言
function insertUserMessage(notLogin) {
	var d = document,
		messageText = d.getElementById("message"),
		message = trim(messageText.value),
		productId = d.getElementById("productId").value,
		userIp = d.getElementById("userIp").value,
		insertMB = d.getElementById("insertMessageBtn");
	if (message == "") {
		alert("留言文字不能为空！");
		//jQuery("#msgCheck").html('留言文字不能为空！').show();
		hiddenTextareaImp();
		messageText.select();
		return;
	}
	if (message.length > 1000) {
		alert("留言文字太长，不能超过1000个字！");
		//jQuery("#msgCheck").html('留言文字太长，不能超过1000个字！').show();
		messageText.select();
		return;
	}
	var code = '';
	if (notLogin == 1) { //检查验证码
		var oCheckCode = jQuery("#checkout");
		if (oCheckCode.length > 0) {
			code = oCheckCode.val();
			if (code == '') {
				refCode('regimg');
				alert("验证码为空!");
				//jQuery("#msgCheck").html('验证码为空').show();	
				return;
			}
		}
	}
	insertMB.disabled = true;

	//jQuery("#msgCheck").hide().html('');
	jQuery("#a5").load("/jsp_cn/jquery/end/product_message.jsp", {
		"pid": productId,
		"islogin": notLogin,
		"code": code,
		"userIp": userIp,
		"message": encodeURI(message),
		"date": new Date().getTime()
	}, function (data) {
		//alert("hehe");
		refreshFatherWindow();

	});
}

function resetText(txt, div) {
	document.getElementById(txt).value = '';
	document.getElementById(div).style.display = 'none';
}

function refreshFatherWindow() {
	//	if(window.opener && window.opener != null && !window.opener.closed){
	if (typeof (refresh) != 'undefined') {
		if (refresh == 1) {
			window.opener.location.href = "http://shequ.docin.com/task/todayTask.do?task_id=110";
		}
	}

	//	}
}
//隐藏消息提示框
function hiddenTextareaImp() {
	var o = document.getElementById("textarea_imp");
	o.style.display = "none";
}

function showTextareaImp() {
	var o = document.getElementById("textarea_imp");
	o.style.display = "";
}
//删除消息
function deleteMessage(messageId) {
	var d = document,
		productId = d.getElementById("productId").value;

	if (confirm("确定要删除吗？")) {
		var url = "/jsp_cn/jquery/end/update_message.jsp?pid=" + productId + "&mId=" + messageId + "&flag=del_mess&date=" + new Date().getTime();
		jQuery("#a5").load(url);
	}
}

//隐藏消息标签
function hiddenMessage(messageId) {
	var d = document,
		o = d.getElementById("userMessageDIV" + messageId);
	o.style.display = "none";
}

//显示回复消息输入框
function showOrHiddenReMessageText(reMsgDivId) {
	var d = document,
		t = d.getElementById(reMsgDivId);
	t.style.display = (t.style.display == "") ? "none" : "";
	//重置滚动条
	if (typeof (frame) != 'undefined') {
		frame.sly('reload');
	}
	if (t.style.display == "") {
		v = 'regimg_re' + reMsgDivId.replace("reMsgDiv", "");
		refCode(v);
	}
}

//重置验证码
function refCode(img_id) {
	var d = document,
		checkImg = d.getElementById(img_id);
	//alert(checkImg);
	if (checkImg != null) {
		checkImg.src = "/servlet/getctime?from=20151118a&" + getTime();
	}
}

function getTime() {
	var d, s = "";
	var c = "";
	d = new Date();
	s += d.getYear() + c;
	s += (d.getMonth() + 1) + c;
	s += d.getDate() + c;
	s += d.getHours() + c;
	s += d.getMinutes() + c;
	s += d.getSeconds() + c;
	s += d.getMilliseconds();
	return s;
}

//插入回复信息
function insertReMessage(reMessageTextId, messageId, senderId, notLogin) {
	var d = document,
		reMessageText = d.getElementById(reMessageTextId),
		reMessage = reMessageText.value,
		productId = d.getElementById("productId").value,
		userIp = d.getElementById("userIp").value;
	reMessage = trim(reMessage);
	if (reMessage == "") {
		alert("留言文字不能为空！");
		reMessageText.select();
		return;
	}
	if (reMessage.length > 1000) {
		alert("留言文字太长，不能超过1000个字！");
		reMessageText.select();
		return;
	}
	var code = '';
	if (notLogin == 1) { //检查验证码
		code = d.getElementById("checkout_re" + messageId).value;
		if (code == '') {
			alert("验证码为空");
			return;
		}
	}
	showApply(reMessageTextId);
	jQuery("#a5").load("/jsp_cn/jquery/end/product_message.jsp", {
		"pid": productId,
		"islogin": notLogin,
		"code": code,
		"userIp": userIp,
		"message": encodeURI(reMessage),
		"date": new Date().getTime(),
		"returnid": messageId
	});
}

//显示验证码
function showCheckCode() {
	var cv = document.getElementById("checkCodeDiv");
	if (cv != null && cv.style.display == "none") {
		cv.style.display = "";
		refCode('regimg');
	}
}

//回复消息内容
function setMsgContent(productId) {
	var d = document,
		msg_c_name = "msg_content_cookie_" + productId;
	temp = getCookie2008_1(msg_c_name);
	if (temp != null && temp != "null") {
		d.getElementById("message").value = temp;
	}
}

//显示回复div
function showReMessageDiv(reUserProductMessageId, reMessage) {
	var d = document,
		reMsgDiv = d.getElementById("reMessageContent" + reUserProductMessageId);
	reMsg = reMsgDiv.innerHTML;
	reMsg = reMsg.replace("reMessageCount", reMessage);
	reMsgDiv.innerHTML = reMsg;
	reMsgDiv.style.display = "";
}

//设置回复连接href
function setReMsgDelA_href(reMessageId, messageId) {
	var d = document,
		a = d.getElementById("reMsgDelA" + messageId);
	if (a != null) {
		a.href = "javascript:deleteReMessageAjax(" + reMessageId + "," + messageId + ")";
	}
}

//删除回复信息
function deleteReMessageAjax(reUserProductMessageId, userProductMessageId) {
	var d = document,
		productId = d.getElementById("productId").value;
	//reMessageContent
	if (confirm("确定要删除吗？")) {
		var url = "/jsp_cn/jquery/end/update_message.jsp?reUserProductMessageId=" + reUserProductMessageId +
			"&pid=" + productId + "&userProductMessageId=" + userProductMessageId + "&flag=deleteReMessage&date=" + new Date().getTime();
		jQuery("#a5").load(url);
	}
}

//显示回复连接
function hiddenReMsgA(userProductMessageId) {
	var d = document;
	d.getElementById("reMsgA" + userProductMessageId).style.display = "none";
}

//删除回复信息
function deleteReMessage(reUserProductMessageId, userProductMessageId) {
	var d = document,
		productId = d.getElementById("productId").value;
	//reMessageContent
	if (confirm("确定要删除吗？")) {
		var url = "/jsp_cn/jquery/end/update_message.jsp?reUserProductMessageId=" + reUserProductMessageId +
			"&pid=" + productId + "&userProductMessageId=" + userProductMessageId + "&flag=deleteReMessage&date=" + new Date().getTime();
		jQuery("#a5").load(url);
	}
}

//隐藏回复div
function hiddenReMessageDiv(reUserProductMessageId) {
	var d = document,
		reMsgDiv = d.getElementById("reMessageContent" + reUserProductMessageId);
	reMsgDiv.style.display = "none";
}

//显示回复连接
function showReMsgA(userProductMessageId) {
	var d = document;
	d.getElementById("reMsgA" + userProductMessageId).style.display = "";
}
//不刷新页面加载消息
function ajaxAddUserMsg() {
	var d = document,
		userMessageDiv = d.createElement("ajaxMessageTemplet");
	msg = d.getElementById("ajaxMessageTemplet").innerHTML;
	msg1 = d.getElementById("message").value;
	msg1 = msg1.replace(/</ig, "&lt;");
	msg1 = msg1.replace(/\r\n/ig, "<br/>");
	msg = msg.replace("userMessage", msg1);
	var messageCount = Math.floor(d.getElementById("messageCount").value) + 1;
	d.getElementById("messageCount").value = messageCount;
	msg = msg.replace("messageCount", messageCount);
	//msg = msg.replace("messageCount","");
	userMessageDiv.innerHTML = msg;
	var addMsgDiv = d.getElementById("ajaxAddUserMessage");
	var showMsgDiv = d.getElementById("ajaxAddUserMessageBottom");
	showMsgDiv.innerHTML = addMsgDiv.innerHTML + showMsgDiv.innerHTML;
	addMsgDiv.innerHTML = "";
	addMsgDiv.innerHTML = msg;
	var total = d.getElementById("total").value;
	if (total == 0) {
		var con = d.getElementById("showMsgContent").innerHTML;
		con = con.replace("暂无评论。", "");
		d.getElementById("showMsgContent").innerHTML = con;
	}
	var t = parseInt(total) + parseInt(1);
	d.getElementById("total").value = t;
}

function showApply(id) {
	var pid = id.substring(9);
	var oUserTx = jQuery("#tempAply .userSpeak").html();
	var msg = jQuery('#' + id).val();
	var oTempAply = jQuery('<div class="listPl listHf"><div class="cont contF"><p>' + oUserTx + '</p><p>' + msg + '</p></div></div>');
	oTempAply.appendTo(jQuery('#msgContent' + pid));
}
//前帖片跳过广告
function showJumpAdv() {
	if (typeof (j_qtp) != "undefined" && j_qtp == 2) {
		jQuery("#beforeAd").remove();
		return;
	}
	if (if_show_jump) { //未登录
		showlogin_jump();
	} else { //已登录

		jQuery.ajax({
			type: 'GET',
			url: "/newEnd/jumpAdv_new.do",
			context: document.body,
			data: "product_id=" + tmp_product,
			success: function (data) {
				if (data) {
					var oHtml = data;
					jQuery(this).append(oHtml);
					var oPenVip = jQuery("#docVipOpen");
					if (oPenVip.length > 0) {
						dialogBoxShadow();
						setObjCenter('docVipOpen');
						var $aInput = jQuery("input[name='vip']");
						$aInput.each(function () {
							if (jQuery(this).is(":checked")) {
								jQuery(this).parent("label").css("color", "#669900");
							}
						});
						$aInput.click(function () {
							$aInput.parent("label").css("color", "#333");
							jQuery(this).parent("label").css("color", "#669900");
						});
					}
				}
			}
		});
	}
}

function showlogin_jump() {
	jQuery("#loginwindow").load("/jsp_cn/weibo/login.jsp", function (data) {
		var key = "show_jump_div";
		var value = "1";
		var exp = new Date();
		exp.setTime(exp.getTime() + 15 * 1000);
		var jump_cookie = key + "=" + escape(value) + ";expires=" + exp.toGMTString();
		document.cookie = jump_cookie;
		dialogBoxShadow();
		if (document.getElementById("newlogin")) {
			setObjCenter("newlogin");
			jQuery('input[placeholder]').placeholder();
			jQuery('input[placeholder]').bind("focus", function () {
				jQuery(this).addClass("txtFocus");
			});
			jQuery('input[placeholder]').bind("blur", function () {
				jQuery(this).removeClass("txtFocus");
			});
		}
		document.getElementById("username_new").focus();
	});
}
//轻松获取豆元
function showGetDouyuan() {
	var getDouyuan = jQuery(".get_douyuan"),
		oBtnDy = jQuery("#dy");
	if (getDouyuan.length > 0 && oBtnDy.length > 0) {
		oBtnDy.bind('click', function () {
			getDouyuan.slideDown();
			jQuery(this).hide();
		});
	}
}


function changeAlert() {
	closeDownLoadDiv("1");
	dialogBoxShadow();
	setObjCenter("downLoadTips4");
}
//函数功能：json 排序  
// filed:(string)排序字段，  
// reverse: (bool) 是否倒置(是，为倒序)  
// primer (parse)转换类型 
function sortBy(filed, reverse, primer) {
	reverse = (reverse) ? -1 : 1;
	return function (a, b) {
		a = a[filed];
		b = b[filed];

		if (typeof (primer) != "undefined") {
			a = primer(a);
			b = primer(b);
		}
		if (reverse == 1) {
			return a - b;
		} else {
			return b - a;
		}
	}
}
//调用  
function sortCourseTime_ASC(clickType) {
	if (typeof (dd) == "undefined" || dd.length == 0 || jQuery("#addFavSuccess").length == 0) {
		//jQuery('<p style="text-align:center;">暂无数据!</p>').appendTo(jQuery(".userBehavMod"));
		return;
	}
	if (clickType == 1) { //按收藏排序
		dd.sort(sortBy('adv', true, parseInt));
		var str = "收藏该文档的用户也收藏",
			pmv = 5510;
	} else if (clickType == 2) { //按下载排序
		dd.sort(sortBy('down', true, parseInt));
		var str = "下载该文档的用户也下载",
			pmv = 5511;
	}
	if (jQuery(".userBehavMod .bd").length > 0) {
		return false;
	}
	var oDocWarp = jQuery('<div class="inner"><div class="hd"><h3 style="font-weight:bold;color:#3c3c3c;">' + str + '</h3></div><div class="bd"></div>').appendTo(jQuery(".userBehavMod"));
	var oDocListUl = jQuery('<ul class="doc_list clear"></ul>').appendTo(jQuery(".userBehavMod .bd"));
	for (var i = 0; i < dd.length; i++) {
		if (i == 4) {
			break;
		}
		var oLiItem = jQuery('<li><div class="li_wrap"><div class="cover"><a href="/p-' + dd[i].pid + '.html" onmousedown="return inpmv(' + pmv + ');" target="_blank"><img onerror="this.src=\'' + picture_image_path_v1 + '/images_cn/no_image/90x80_no.gif\'' + '" src="https://img1.douding.cn/docin_' + dd[i].pid + '_110x140.jpg" alt="' + dd[i].title + '"><span class="pageno">' + dd[i].pageno + '</span></a></div><p class="title"><a href="/p-' + dd[i].pid + '.html" onmousedown="return inpmv(5319);" target="_blank" title="' + dd[i].title + '">' + dd[i].title + '</a></p></div></li>').appendTo(oDocListUl);
	}
}

//一下是下载进度条js
function getHttpRequest() {
	var xmlHttp;
	try {
		//firefox,opera 8.0+,safari 浏览器
		xmlHttp = new XMLHttpRequest();
	} catch (e) {
		try {
			//ie
			xmlHttp = new ActiveXobject("Msxml2.XMLHTTP");
		} catch (e) {
			try {
				xmlHttp = new ActiveXobject("Microsoft.XMLHTTP");
			} catch (e) {
				alert("得不到xmlhttp");
			}
		}
	}
	return xmlHttp;
}

function loadScript(url, callback) {
	var script = document.createElement("script")
	script.type = "text/javascript";
	if (script.readyState) { //IE
		script.onreadystatechange = function () {
			if (script.readyState == "loaded" || script.readyState == "complete") {
				script.onreadystatechange = null;
				callback();
			}
		};
	} else { //Others
		script.onload = function () {
			callback();
		};
	}
	script.src = url;
	document.getElementsByTagName("head")[0].appendChild(script);
}

function download(url, su, productId) {
	var ajax = getHttpRequest();
	ajax.open("GET", url, true);
	ajax.responseType = "blob";
	if (readerConfig.downloadId) { //
		var btn = readerConfig.downloadId;
		jQuery(btn).parent().append('<div class="outerProg"><div class="downProg"><div class="progBar"></div><div class="progNum progNumA"><b></b></div><div class="progNum progNumB"><b></b></div></div></div>');
	} else {
		jQuery('#docDownload').parent().append('<div class="outerProg"><div class="downProg"><div class="progBar"></div><div class="progNum progNumA"><b></b></div><div class="progNum progNumB"><b></b></div></div></div>');
	}
	ajax.onreadystatechange = function () {
		if (ajax.readyState == 4) {
			if (ajax.status == 200) {
				su(ajax.response);
				downloadSuccess(productId);
			}
		}
	};
	//设置进度监听事件，实时监听进度
	ajax.addEventListener("progress", function (e) {
		var currLoaded = e.loaded;
		var percent = Math.floor((currLoaded / e.total) * 100) + "%";

		jQuery('.progNumA').children('b').text(percent);
		jQuery('.progNumB').children('b').text(percent);
		jQuery('.progBar').width(Math.floor((currLoaded / e.total) * 102) + "%");

		if (e.loaded == e.total) {
			jQuery('.outerProg').remove();
		}
	});
	ajax.send(null);
}

! function () {
	/*设置ajax全局默认值*/
	jQuery.ajaxSetup({
		async: true,
		cache: false
		//dataType: 'json'
	});
	/*ajax预处理缓存*/
	var ajaxRequestList = {};
	/*
	 	判断唯一标识,同一个ajax只能同时存在一次
	 	single(string): 唯一标识
	 	mine(boolean): 如果ajax标识重复则用自身(true)还是原来的
	 	once(boolean): 是否唯一，唯一(true)则只会请求成功一次
	 */
	jQuery.ajaxPrefilter(function (options, originalOptions, jqXHR) {
		if (typeof originalOptions.single === 'string') {
			if (!ajaxRequestList[originalOptions.single]) {
				ajaxRequestList[originalOptions.single] = jqXHR;
				if (originalOptions.once === true) {
					jqXHR.fail(function () {
						delete ajaxRequestList[originalOptions.single];
					});
				} else {
					jqXHR.always(function () {
						delete ajaxRequestList[originalOptions.single];
					});
				}
			} else {
				if (originalOptions.mine === true) {
					ajaxRequestList[originalOptions.single].abort();
				} else {
					jqXHR.abort();
				}
			}
		}
	});
}();

function closeAdv_vip(f) { //判断关闭广告弹出开通vip提示  f:1是页间广告关闭 2：相关文档底下广告关闭 3:直接打印
	var tipText = '';
	var btnText = '';
	var vipHref = '';
	var ipv = 0;
	var tipTitle = "";
	var tipsIcon = "";
	var tipsEnd = "";
	if (readerConfig.isdocstore != undefined && readerConfig.isdocstore == 1) {
		vipHref = '/jsp_cn/my/fin/tool_vip/get_tool_vip.jsp?vipfrom=end&t=adv&pid=' + tmp_product;
		if (f == 3) {
			tipTitle = '开通会员 享文档打印功能';
			vipHref = vipHref + '&isPrint=print';
			tipsIcon = '<div class="need-vip-tips-mt-copy"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">复制文本<br></p></div>';
			tipsEnd = '<p class="bottomtip">*如遇收费文档，则需先购买再打印，最终解释权归豆丁网所有</p>';
		} else {
			tipTitle = '开通会员 享文档页零广告';
			tipsIcon = '<div class="need-vip-tips-mt-kefu"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">专属客服<br></p></div>';
		}
		btnText = '点击开通会员 享尊贵权益';
		if (f == 1) {
			ipv = 7097;
		} else if (f == 2) {
			ipv = 6428;
		}
		tipText = '<div class="need-vip-tips-t"><span class="need-vip-tips-tt">' + tipTitle + '</span><span class="need-vip-tips-tb">现在开通<span style="color:#f8692a;">享10项特权</span> 低至 <span style="color:#f8692a;">0.5元/天</span></span></div><div class="need-vip-tips-mt"><div class="need-vip-tips-mt-noads"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">阅读文档页<br>零广告</p></div><div class="need-vip-tips-mt-down"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">下载非收费文档<br>100篇/天</p></div><div class="need-vip-tips-mt-downQuan"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">下载收费文档<br>赠专用券</p></div>'+tipsIcon+'</div><div class="need-vip-tips-mb"><a style="text-decoration:none;" href="' + vipHref + '" onmousedown="inpmv('+ipv+')" target="_blank" title="'+btnText+'"><span style="color:#fff;">'+btnText+'</span></a></div>'+tipsEnd;
	} else if (typeof (isBuilding) != "undefined" && isBuilding == 1) {
		vipHref = '/jsp_cn/my/fin/build_vip/get_build_vip.jsp?vip_type=12&vipfrom=end&pid=' + tmp_product + '&no_eject=1';
		if (f == 3) {
			tipTitle = '开通会员 享文档打印功能'
			vipHref = vipHref + '&isPrint=print';
			tipsIcon = '<div class="need-vip-tips-mt-copy"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">复制文本<br></p></div>';
			tipsEnd = '<p class="bottomtip">*如遇收费文档，则需先购买再打印，最终解释权归豆丁网所有</p>';
		} else {
			tipTitle = '开通会员 享文档页零广告';
			tipsIcon = '<div class="need-vip-tips-mt-kefu"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">专属客服<br></p></div>';
		}
		btnText = '点击开通会员 享尊贵权益';
		if (f == 1) {
			ipv = 7096;
		} else if (f == 2) {
			ipv = 6427;
		}
		tipText = '<div class="need-vip-tips-t"><span class="need-vip-tips-tt">' + tipTitle + '</span><span class="need-vip-tips-tb">现在开通<span style="color:#f8692a;">享10项特权</span> 低至 <span style="color:#f8692a;">0.5元/天</span></span></div><div class="need-vip-tips-mt"><div class="need-vip-tips-mt-noads"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">阅读文档页<br>零广告</p></div><div class="need-vip-tips-mt-down"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">下载非收费文档<br>100篇/天</p></div><div class="need-vip-tips-mt-downQuan"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">下载收费文档<br>赠专用券</p></div>'+tipsIcon+'</div><div class="need-vip-tips-mb"><a style="text-decoration:none;" href="' + vipHref + '" onmousedown="inpmv('+ipv+')" target="_blank" title="'+btnText+'"><span style="color:#fff;">'+btnText+'</span></a></div>'+tipsEnd;
	} else {
		vipHref = '/app/jump_adv/pay_vip.do?channelid=0313&t=adv&buyFrom=2&pid=' + tmp_product;
		if (f == 3) {
			tipTitle = '开通VIP 享文档打印功能';
			vipHref = vipHref + '&isPrint=print';
			tipsIcon = '<div class="need-vip-tips-mt-copy"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">复制文本<br></p></div>';
			tipsEnd = '<p class="bottomtip">*如遇收费文档，则需先购买再打印，最终解释权归豆丁网所有</p>';
		} else {
			tipTitle = '开通VIP 享文档页零广告';
			tipsIcon = '<div class="need-vip-tips-mt-kefu"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">专属客服<br></p></div>';
		}
		btnText = '点击开通VIP 享尊贵权益';
		//if(f == 1){
		ipv = 7098;
		//}
		tipText = '<div class="need-vip-tips-t"><span class="need-vip-tips-tt">' + tipTitle + '</span><span class="need-vip-tips-tb">现在开通<span style="color:#f8692a;">享7项特权</span> 低至 <span style="color:#f8692a;">0.3元/天</span></span></div><div class="need-vip-tips-mt"><div class="need-vip-tips-mt-noads"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">阅读文档页<br>零广告</p></div><div class="need-vip-tips-mt-down"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">下载非收费文档<br>100篇/天</p></div><div class="need-vip-tips-mt-convert"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">文档转换<br></p></div>'+tipsIcon+'</div><div class="need-vip-tips-mb"><a style="text-decoration:none;" href="' + vipHref + '" onmousedown="inpmv('+ipv+')" target="_blank" title="'+btnText+'"><span style="color:#fff;">'+btnText+'</span></a></div>'+tipsEnd;
	}
	if (f == 1 || f == 2) {
		window.open(vipHref);
		return;
	}
	var openVipAlert = new CreateDocinDialog({
		id: "openVipTips",
		cls: "need-vip-tips",
		title: " ",
		content: tipText,
		button: 2,
	});
}
var partnerHandel = {
	init: function () {
		var _this = this;
		_this.supTipsTimer = null;
		var oPartEnt = jQuery("#partnerEntr");
		if (oPartEnt.length == 1) {
			oPartEnt.bind("click", function () {
				_this.createPartnerLayout();
				_this.partnerBtnHandel();
				if (jQuery(".partner_guide_tips").length > 0) {
					jQuery(".partner_guide_tips").remove();
				}
				inpmv(7248);
			});
		};
		_this.createPartnerTips();
	},
	createPartnerTips: function () {
		var _this = this;
		if (jQuery("#partnerEntr").length > 0) {
			var partnerValue = getCookie2008_1("partner_tips");
			if (partnerValue == null) {
				var iPartnerLeft = jQuery("#partnerEntr").position().left;
				jQuery('<div class="partner_guide_tips"></div>').appendTo(jQuery('.doc_header_mod'));
				if (jQuery('.doc_basic_info').length > 0) {
					var iTop = jQuery(".doc_basic_info").outerHeight() + 28 + jQuery(".doc_active_info").height();
				} else {
					var iTop = jQuery(".doc_header_mod h1").outerHeight() + 5 + jQuery(".doc_active_info").height();
				}
				jQuery(".partner_guide_tips").css({
					left: iPartnerLeft - 8,
					top: iTop
				});
				setCookie2008_1("partner_tips", 1, 60 * 24 * 365);

			} else {
				if (jQuery(".partner_guide_tips").length > 0) {
					jQuery(".partner_guide_tips").remove();
				}
			}
		}
	},
	partnerBtnHandel: function () {
		var _this = this;
		if (typeof (readerConfig) != "undefined") {
			_this.productId = readerConfig.productId;
		}
		jQuery.ajax({
			type: 'GET',
			url: "/app/partner/clickEndPagePartner",
			async: true,
			data: "pid=" + _this.productId,
			single: "clickEndPagePartner",
			success: function (data) {
				if (data) {
					var iData = data;
					if (iData.code == 103) {
						alert("哎呀，不巧，文档被卖出去了~");
						return false;
					}
					if (iData.code != 1) { //请求失败
						return false;
					}
					var iStatuTxt = "开放申请 (0)"; //合伙人状态
					var partner_pid = iData.pid, //文档编号
						doc_price = iData.downprice, //下载
						doc_title = iData.productName, //文档标题
						partner_status = iData.partnerType, //合伙人状态 1、开放申请 2、已满员 3、已锁止，开始分红 4、未锁止，开始分红
						partner_seats = iData.seatNums, //已投资席位
						seatPrice = iData.seatPrice, //席位价格
						partner_items = iData.list, //席位列表
						isFenghong = iData.hasFenHong, //是否有分红
						ifInvested = iData.ifInvested; //是否是当前文档投资人
					var partnerListStr = ""; //合伙人列表
					var partnerBtnStr = ""; //申请购买按钮文字
					var partnerDesc = "";
					if (partner_status == 1) {
						iStatuTxt = '开放申请（' + partner_seats + '）';
						if (partner_items.length == 0) { //没人加入
							for (var i = 0; i < 4; i++) {
								if (i == 0) {
									iTxt = '首席合伙人 (￥' + seatPrice.s1 + '/年)';
									partnerListStr += '<div class="partner_item partner_null"><div class="partner_pic">待加入</div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">（抢首席）</div></div>';
								} else {
									if (i == 1) {
										iTxt = '第二合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
									}
									if (i == 2) {
										iTxt = '第三合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
									}
									if (i == 3) {
										iTxt = '第四合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
									}
									partnerListStr += '<div class="partner_item forbidden_item"> <div class="partner_pic">暂无</div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">（空缺）</div></div>';
								}
							}

							partnerBtnStr = '<a class="partner_join_btn" href="javascript:void(0);">￥0.5/年 加入该文档合伙人</a>';
							partnerDesc = '本文档已开放合伙人申请，目前首席还是空缺，如果您认为本文档具有销售潜力，';
						} else if (partner_items.length > 0) { //有人加入，但是不满员
							for (var i = 0; i < 3; i++) {
								var iTxt = '';
								var iSeatIndex = "";
								if (i == 0) {
									iTxt = '首席合伙人 (￥' + seatPrice.s1 + '/年)';
								} else {
									if (i == 1) {
										iTxt = '第二合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
										iSeatIndex = "二";
									}
									if (i == 2) {
										iTxt = '第三合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
										iSeatIndex = "三";
									}
								}
								if (i < partner_seats) {
									partnerListStr += '<div class="partner_item"><div class="partner_pic"><img src="' + partner_items[i].userImg + '" /></div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">' + partner_items[i].nickName + '</div></div>';
								} else if (i == partner_seats) {
									if (ifInvested == true) { //投资者本人
										partnerListStr += '<div class="partner_item forbidden_item"><div class="partner_pic">暂无</div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">（空缺）</div></div>';
									} else {
										partnerListStr += '<div class="partner_item partner_null"><div class="partner_pic">待加入</div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">（抢' + iSeatIndex + '席）</div></div>';
									}

								} else {
									partnerListStr += '<div class="partner_item forbidden_item"><div class="partner_pic">暂无</div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">（空缺）</div></div>';
								}
							}
							if (partner_seats == 3) {
								if (ifInvested == true) { //投资者本人
									partnerListStr += '<div class="partner_item forbidden_item"><div class="partner_pic">暂无</div><div class="partner_icon">第四合伙人(￥' + seatPrice.s4 + '/年)</div><div class="partner_name">（空缺）</div></div>';
								} else {
									partnerListStr += '<div class="partner_item partner_null"><div class="partner_pic">待加入</div><div class="partner_icon">第四合伙人(￥' + seatPrice.s4 + '/年)</div><div class="partner_name">(仅剩一席)</div></div>';
								}

							} else if (partner_seats < 3) {
								partnerListStr += '<div class="partner_item forbidden_item"><div class="partner_pic">暂无</div><div class="partner_icon">第四合伙人(￥' + seatPrice.s4 + '/年)</div><div class="partner_name">（空缺）</div></div>';
							}
							partnerBtnStr = '<a class="partner_join_btn" href="javascript:void(0);">￥' + seatPrice['s' + (partner_seats + 1)] + '/年 加入该文档合伙人</a>';
							partnerDesc = '本文档已开放合伙人申请，目前已有 <span id="curAdderNum"></span> 席加入，如果您认为本文档具有销售潜力，';

						}

					} else if (partner_status == 2) { //已满员
						iStatuTxt = '<span class="fc9">已满员（4）</span>';
						for (var i = 0; i < 4; i++) {
							var oFenghong = "";
							if (i == 0) {
								iTxt = '首席合伙人 (￥' + seatPrice.s1 + '/年)';
							} else {
								if (i == 1) {
									iTxt = '第二合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
								}
								if (i == 2) {
									iTxt = '第三合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
								}
								if (i == 3) {
									iTxt = '第四合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
								}
							}
							if (isFenghong && partner_items[i] != undefined) {
								if (partner_items[i].shouYi != undefined) {
									oFenghong = '<div class="partner_award">共分红：' + partner_items[i].shouYi + '豆元</div>';
								}
							}
							partnerListStr += '<div class="partner_item"><div class="partner_pic"><img src="' + partner_items[i].userImg + '" /></div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">' + partner_items[i].nickName + '</div>' + oFenghong + '</div>';
						}
						partnerBtnStr = '<a class="partner_join_btn btn_default" href="javascript:void(0);">已满员</a>';
						partnerDesc = '本文档合伙人已满员，共有 4 席加入。欢迎继续去发现其他您认为具有销售潜力，';
					} else if (partner_status == 3) { //已锁止，开始分红
						iStatuTxt = '<span class="fc9">已锁止，开始分红 (' + partner_seats + ')</span>';
						partnerBtnStr = '';
						for (var i = 0; i < 4; i++) {
							var oFenghong = "";
							if (i == 0) {
								iTxt = '首席合伙人 (￥' + seatPrice.s1 + '/年)';
							} else {
								if (i == 1) {
									iTxt = '第二合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
								}
								if (i == 2) {
									iTxt = '第三合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
								}
								if (i == 3) {
									iTxt = '第四合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
								}
							}
							if (i < partner_seats) {
								if (isFenghong) {
									oFenghong = '<div class="partner_award">共分红：' + partner_items[i].shouYi + '豆元</div>';
								}
								partnerListStr += '<div class="partner_item"><div class="partner_pic"><img src="' + partner_items[i].userImg + '" /></div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">' + partner_items[i].nickName + '</div>' + oFenghong + '</div>';
							} else {
								partnerListStr += '<div class="partner_item forbidden_item"><div class="partner_pic"><span class="disabled_add"></span></div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">（锁止）</div></div>';
							}

						}
						partnerDesc = '本文档合伙人已锁止，共有 ' + partner_seats + ' 席加入。欢迎继续去发现其他您认为具有销售潜力，';

					} else if (partner_status == 4) { //未锁止，开始分红
						iStatuTxt = '开始分红（' + partner_seats + '）';
						partnerBtnStr = '<a class="partner_join_btn" href="javascript:void(0);">￥' + seatPrice['s' + (partner_seats + 1)] + '/年 加入该文档合伙人</a>';
						for (var i = 0; i < 3; i++) {
							var iSeatIndex = "";
							var oFenghong = "";
							if (i == 0) {
								iTxt = '首席合伙人 (￥' + seatPrice.s1 + '/年)';
							} else {
								if (i == 1) {
									iTxt = '第二合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
									iSeatIndex = "二";
								}
								if (i == 2) {
									iTxt = '第三合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
									iSeatIndex = "三";
								}
								if (i == 3) {
									iTxt = '第四合伙人(￥' + seatPrice['s' + (i + 1)] + '/年)';
								}
							}

							if (isFenghong && partner_items[i] != undefined) {
								if (partner_items[i].shouYi != undefined) {
									oFenghong = '<div class="partner_award">共分红：' + partner_items[i].shouYi + '豆元</div>';
								}
							}
							if (i < partner_seats) {
								partnerListStr += '<div class="partner_item"><div class="partner_pic"><img src="' + partner_items[i].userImg + '" onerror="this.src=\'' + picture_image_path_v1 + '/images_cn/people01_48x48.gif\'" /></div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">' + partner_items[i].nickName + '</div>' + oFenghong + '</div>';
							} else {
								if (ifInvested == true) { //投资者本人
									partnerListStr += '<div class="partner_item forbidden_item"><div class="partner_pic">暂无</div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">（空缺）</div></div>';
								} else {
									if (i == partner_seats) {
										if (partner_seats == 3) {
											partnerListStr += '<div class="partner_item partner_null"><div class="partner_pic">待加入</div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">(仅剩一席)</div></div>';
										} else {
											partnerListStr += '<div class="partner_item partner_null"><div class="partner_pic">待加入</div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">（抢' + iSeatIndex + '席）</div></div>';
										}

									} else {
										partnerListStr += '<div class="partner_item forbidden_item"> <div class="partner_pic">暂无</div><div class="partner_icon">' + iTxt + '</div><div class="partner_name">（空缺）</div></div>';
									}
								}

							}

						}
						if (partner_seats == 3) {
							if (ifInvested == true) { //投资者本人
								partnerListStr += '<div class="partner_item forbidden_item"><div class="partner_pic">暂无</div><div class="partner_icon">第四合伙人(￥' + seatPrice.s4 + '/年)</div><div class="partner_name">（空缺）</div></div>';
							} else {
								partnerListStr += '<div class="partner_item partner_null"><div class="partner_pic">待加入</div><div class="partner_icon">第四合伙人(￥' + seatPrice.s4 + '/年)</div><div class="partner_name">(仅剩一席)</div></div>';
							}

						} else if (partner_seats < 3) {
							partnerListStr += '<div class="partner_item forbidden_item"><div class="partner_pic">暂无</div><div class="partner_icon">第四合伙人(￥' + seatPrice.s4 + '/年)</div><div class="partner_name">（空缺）</div></div>';
						}
						partnerBtnStr = '<a class="partner_join_btn" href="javascript:void(0);">￥' + seatPrice['s' + (partner_seats + 1)] + '/年 加入该文档合伙人</a>';
						partnerDesc = '本文档已开放合伙人申请，目前已有 <span id="curAdderNum"></span> 席加入，如果您认为本文档具有销售潜力，';

					}
					if (ifInvested == true) {
						jQuery(".doc_partner_hd h4").html("Hi,合伙人");
						partnerBtnStr = '<a class="partner_join_btn" onmousedown="return inpmv(7250);" href="/app/partner/myInvestProducts" target="_blank">我投资的文档</a>';
					}
					jQuery("#p_id").html(partner_pid);
					jQuery(".info_list_item h3").html(doc_title);
					jQuery("#p_price").html(doc_price);
					jQuery("#p_status").html(iStatuTxt);
					jQuery("#partner_desc").html(partnerDesc);
					jQuery(".partner_list").html(partnerListStr);
					jQuery(".partner_join").html(partnerBtnStr);
					if (jQuery("#curAdderNum").length > 0) {
						jQuery("#curAdderNum").html(partner_seats);
					}
					if (ifInvested == false) {
						jQuery("#j_partnerLayout .partner_join_btn").click(function () {
							if (jQuery(this).hasClass("btn_default")) {
								return false;
							}
							inpmv(7249);
							jQuery("#j_partnerLayout").remove();
							_this.joinToPartnerHandel();
						});
					}
				}
			}
		});
	},
	createPartnerLayout: function () {
		var _this = this;
		var iStr = "";
		iStr += '<div id="j_partnerLayout" class="doc_partner_layout"><div class="doc_partner_layout_inner"><div class="doc_partner_hd"> <span class="i_close"></span>';
		iStr += '<h4>文档合伙人</h4><p>发现高价值好文档，加入文档合伙人，终身享文档收益分红</p></div><div class="doc_partner_bd">';
		iStr += '<div class="doc_partner_info"><ul class="doc_partner_info_list">';
		iStr += '<li class="info_list_item"><div class="i_left">文档编号：</div><p class="i_txt"><span id="p_id"></span><span class="ft14">（下载价格：<span id="p_price"></span>豆元）</span></p></li>';
		iStr += '<li class="info_list_item"><div class="i_left">文档标题：</div><h3 class="i_txt">载入中</h3></li>';
		iStr += '<li class="info_list_item"><div class="i_left">合伙人状态：</div><p id="p_status" class="i_txt">载入中</p></li>';
		iStr += '<li class="info_list_item"><div class="i_left">合伙人说明：</div><div class="partner_instro"><ul><li><span class="i_pot">·</span><span id="partner_desc"></span>是高价值且合法 <sup data-subIndex="1">注1</sup> 的好文档，欢迎按席位价格支付，即可成为本文档合伙人。</li><li><span class="i_pot" style="top:5px;">·</span>文档合伙人可享本文档未来每次售出的收益分红（合伙人均分10%销售收入<sup data-subIndex="2">注2</sup> ）。</li><li><span class="i_pot">·</span>每篇文档合伙人最多4席，且文档一经售出立即锁止合伙人席位，不再开放申请（文档未来售出的收益分红由锁止前的合伙人均分，例：锁止前仅1席，该合伙人将独享收益分红）</li></ul></div></li>';
		iStr += '<li class="info_list_item"><div class="i_left" style="position:relative;top:32px;">合伙人席位：</div><div class="partner_list"></div></li>';
		iStr += '</ul></div><div class="partner_join"></div><div class="doc_partner_ft"><p>本活动最终解释权归豆丁网所有</p></div>';
		iStr += '</div></div></div>';
		jQuery(iStr).appendTo(jQuery(document.body));
		_this.setCenter("j_partnerLayout");
		_this.showSubLayout();
		jQuery("#j_partnerLayout .i_close").unbind("click").bind("click", function () {
			jQuery("#j_partnerLayout").remove();
		});
	},
	setCenter: function (id) {
		var _this = this;
		if (jQuery("#partnerEntr").length > 0) {
			jQuery("#j_partnerLayout").show();
			var iTop = jQuery("#partnerEntr").offset().top + 25;
			var iLeft = (jQuery(window).width() - jQuery("#j_partnerLayout").width()) / 2;
			if (window.screen.height <= 768) {
				iTop = 50;
			}
			jQuery("#j_partnerLayout").css({
				'position': 'absolute',
				'top': iTop,
				'left': iLeft
			});
		}

	},
	showSubLayout: function () {
		var _this = this;
		var supTipsTimer = null;
		var supTipsTxt = ['若文档因违法违规侵权等原因而被下架，则该文档合伙机制同时终止，不再有收益/分红，合伙人已支付的投资金额不予退还，特此说明。', '销售收入指文档售出时买家支付的全部豆元（含奖励豆元、充值豆元）,分红时各豆元按比例均分。合伙人分红不影响文档上传人的收益。'];
		jQuery('.doc_partner_layout sup').unbind("mouseenter").bind("mouseenter", function () {
			var iSupindex = jQuery(this).data("subindex");
			var iLayoutLeft = jQuery(".doc_partner_layout").offset().left + 137;
			var iLayoutTop = jQuery(this).offset().top + 30;
			var iConerLeft = jQuery(this).offset().left - iLayoutLeft;
			if (jQuery(".supTipsLayout").length > 0) {
				jQuery(".supTipsLayout").remove();
			}
			clearTimeout(supTipsTimer);
			jQuery('<div class="supTipsLayout"><i class="i_top_coner" style="left:' + iConerLeft + 'px"></i><div class="inner"><sup>注' + iSupindex + '</sup><p>' + supTipsTxt[iSupindex - 1] + '</p><div></div>').appendTo(jQuery(document.body));
			jQuery(".supTipsLayout").css({
				"left": iLayoutLeft,
				"top": iLayoutTop
			});

			jQuery(".supTipsLayout").bind("mouseenter", function () {
				clearTimeout(supTipsTimer);
			});
			jQuery(".supTipsLayout").bind("mouseleave", function () {
				clearTimeout(supTipsTimer);
				supTipsTimer = setTimeout(function () {
					jQuery(".supTipsLayout").fadeOut();
				}, 200);
			});
		});
		jQuery('.doc_partner_layout sup').unbind("mouseleave").bind("mouseleave", function () {
			clearTimeout(supTipsTimer);
			supTipsTimer = setTimeout(function () {
				jQuery(".supTipsLayout").fadeOut();
			}, 200);

		});
	},
	joinToPartnerHandel: function () {
		var _this = this;
		jQuery.ajax({
			type: "GET",
			url: '/app/partner/joinToPartner',
			data: "pid=" + _this.productId,
			success: function (data, textStatus) {
				var myData = data;
				if (myData.code == 101) { //自己的文档，不允许加入合伙人
					var partnerInvestTips = new CreateDocinDialog({
						title: '',
						id: 'j_InvestTips',
						cls: 'partnerInvestTips',
						content: '<div style="margin-bottom:10px;"><p style="font-size:14px;line-height:30px;color:#333;margin-bottom:10px;">抱歉，您不能加入自己上传的文档合伙人<br/>请选择他人上传的文档加入合伙人。</p></div>',
						cancel: {
							txt: "",
							value: false
						},
						confirm: {
							txt: "我知道了",
							value: true
						},
						button: 1,
						shadow: 1
					});
					return false;
				}
				if (myData.code == 102) { //合伙人席位满了，不能购买
					var partnerInvestTips = new CreateDocinDialog({
						title: '',
						id: 'j_InvestTips',
						cls: 'partnerInvestTips',
						content: '<div style="margin-bottom:10px;"><p style="font-size:14px;line-height:30px;color:#333;margin-bottom:10px;">抱歉，席位已满，不能购买！</p></div>',
						cancel: {
							txt: "",
							value: false
						},
						confirm: {
							txt: "我知道了",
							value: true
						},
						button: 1,
						shadow: 1
					});
					return false;
				}
				if (myData.code == 103) {
					alert("哎呀，不巧，文档被卖出去了~");
					return false;
				}
				if (myData.code == 4 || myData.code == 3) { //失败
					console.log("加入失败");
					return false;
				}
				if (typeof (myData.code) == "undefined") {
					if (jQuery(".j_rechargeDiv").length > 0) {
						jQuery(".j_rechargeDiv").remove();
					}
					jQuery('<div class="j_rechargeDiv">' + myData + '</div>').appendTo(jQuery(document.body));
					dialogBoxShadow();
					if (jQuery("#quickDown").length == 1) {
						setObjCenter("quickDown");
					} else if (jQuery("#downLoadTips2").length == 1) {
						setObjCenter("downLoadTips2");
					}


				}
			},
			error: function (XMLHttpRequest, textStatus, errorThrown) {}
		});
	}
};
showGetDouyuan();
initInsertDoclist(product_id);
initdownload();
initbooksave();
initPayRead();
initPayRead_v2();
completeTipsLayout(); //加入会员，赠送下载券
initPartner();
if (jQuery("#partnerEntr").length > 0) { //合伙人入口
	partnerHandel.init();
}
jQuery(function () {
	if (jQuery(".doc_active_info .doc_active_box").length > 0) {
		var iPlayerWidth = jQuery(".doc_active_info").width();
		var iActiveLeft = jQuery(".doc_active_info .doc_active_box").width();
		if (iPlayerWidth - iActiveLeft > 200) {
			if (jQuery("#showPrice").length > 0) {
				jQuery("#showPrice").show();
			}
			if (jQuery(".docin_share_sns").length > 0) {
				jQuery(".docin_share_sns").show();
			}
		} else {
			if (typeof (isBuilding) != "undefined" && isBuilding == 1) {
				jQuery("#showPrice").show();
			}
			// if(jQuery(".price_style").length>0){//企业工具文档
			// 	jQuery('<span id="toolPrice" style="font-size:12px;padding-right:10px;color:#898989;"></span>').prependTo(jQuery(".reader_bottom_tools"));
			// 	jQuery("#toolPrice").html(jQuery(".price_style").html());
			// }
			// if (jQuery("#showPrice").length > 0) { //建筑文档
			// 	jQuery('<span id="toolPrice" style="font-size:12px;padding-right:10px;color:#898989;"></span>').prependTo(jQuery(".reader_bottom_tools"));
			// 	jQuery("#toolPrice").html(jQuery("#showPrice").html());
			// }
		}
	}
});

function docinPrintHandel() {
	var oPrintBtn = jQuery("#j_print,.doc_print_btn");
	if (oPrintBtn.length == 0) {
		return false;
	}
	var bIsFreeDoc = typeof (isFreeDoc) != "undefined" ? isFreeDoc : "";
	var build_type = "false";
	if (typeof (readerConfig) != "undefined" && readerConfig.isDocin != undefined) {
		build_type = readerConfig.isDocin + '';
	}
	if (oPrintBtn.length > 0) {
		var iType = oPrintBtn.data("print");
		if (iType == 2) { //非canvas文档
			LoadJS(picture_image_path_v1 + '/js/canvas/react.production.min.js?rand=20201022', 0, function () {
				LoadJS(picture_image_path_v1 + '/js/canvas/react-dom.production.min.js?rand=20201022', 0, function () {
					LoadJS(picture_image_path_v1 + '/js/canvas/'+ canvas_version +'/jgcw-page.js?rand=20201022', 0, function () {
						var headURLFun = function (headIndex) {
							var head_url = 'https://' + readerConfig.load_url + "/head_" + readerConfig.productId + "_" + headIndex + ".docin?sid=" +
								readerConfig.flash_param_hzq;
							return head_url;
						}
						var pageURLFun = function (pageIndex) {
							var page_url =
								'https://' + readerConfig.load_url + "/page_" + readerConfig.productId + "_" + pageIndex + ".docin?sid=" + readerConfig.flash_param_hzq;;
							return page_url;
						}
						var callbackmgr = {
							headURLFun: headURLFun,
							pageURLFun: pageURLFun
						}

						var jgcw = picture_image_path_v1 + "/js/canvas/"+ canvas_version +"/jgcw.js?rand=20212026";
						var support = initDocinRender && initDocinRender(readerConfig.productId, callbackmgr, jgcw);
					});
				});
			});


		}

	}
	oPrintBtn.on("click", function () {
		if (readerConfig.isLogin == 0) { //未登录
			jQuery.ajax({
				type: 'GET',
				url: "/newEnd/isAlertLoginLayer.do",
				context: document.body,
				data: "pid=" + tmp_product + "&fn=" + bIsFreeDoc + "&build_type=" + build_type + "&isPrint=print",
				single: 'loginLayer',
				success: function (data) {
					if (data) {
						if (data != "-1") { //未登录时,游客购买
							var oHtml = data;
							jQuery(this).append(oHtml);
							dialogBoxShadow();
							setObjCenter("quickDown");
							lastLoginTips(1);
						} else { //普通登录框
							var cook = new CookieClass();
							cook.expires = 1;
							cook.domain = ".docin.com";
							cook.path = "/";
							cook.setCookie("print_login" + tmp_product, "1");
							changeCookieValue(cook, "print_login" + tmp_product, 1);
						}
					}
				}
			});

			return false;
		} else {
			payForPint(product_id, bIsFreeDoc);
		}

	});
	inpv_new_v2(727);
}

function createPrintLayout() {
	if (jQuery("#oPrintTipsDiv").length > 0) {
		return;
	}
	var iContent = '<div class="inner"><div class="print_wait">准备打印，请您耐心等待...</div><div class="print_collect">正在收集第<span id="curPage">1</span>/' + readerConfig.allPage + '页</div><div class="pagePercent"><div class="percentWidth"></div></div></div><div class="wx_tips"><p>温馨提示：</p><p>如果等待时间较长，您可以免费下载文档到本地，进行打印。</p></div>'
	var oPrintTipsDiv = new CreateDocinDialog({
		id: 'oPrintTipsDiv',
		cls: 'printLayout',
		title: " ",
		content: iContent,
		button: 2,
		shadow: 1,
		closeCallBack: function () {
			setTimeout(function () {
				location.reload();
			}, 500);
		}
	});
}

function printProgress(pageIndex, totalPercent) {
	var iPercent = totalPercent.toFixed(2) * 100 + "%" == "100%" ? "99%" : totalPercent.toFixed(2) * 100 + "%";
	var curPage = pageIndex+1;
	jQuery("#curPage").html(curPage);
	readerConfig.tempPage = curPage;
	jQuery("#oPrintTipsDiv .percentWidth").width(iPercent);
	return true;
}

function beforePrint(){
	jQuery("#oPrintTipsDiv").remove();
	jQuery("#dialogShadow").remove();
	readerConfig.tempPage = 1;
	inpmv(7321);
}

function doPrint() {
	if (readerConfig.tempPage > 1) {
		return false;
	}
	var allPage = 0;
	if (typeof (readerConfig) != "undefined") {
		allPage = readerConfig.allPage;
	}
	createPrintLayout();
	try {
		setTimeout(function () {
			docinPrint(0, allPage, printProgress, beforePrint);
		}, 1000);
	} catch (err) {
		setTimeout(function () {
			docinPrint(0, allPage, printProgress, beforePrint)
		}, 1000);
		inpmv(7322);
	}
}

function payForPint(productId, fn) {
	var random = new Date().getTime();
	var iCid = 0;
	if (jQuery("#coupon_sel").length > 0) {
		iCid = jQuery('#coupon_sel option:selected').data("cid");
	}
	jQuery.ajax({
		type: 'GET',
		url: "/newEnd/down_load_new_v1.do",
		dataType: "html",
		async: iAsync,
		context: document.body,
		data: "pid=" + productId + "&fn=" + fn + "&flag=down&cid=" + iCid + "&isPrint=print&datetime=" + random,
		single: "printDoc",
		success: function (data) {
			var iIndex = data.indexOf("21|");
			var iIndex2 = data.indexOf("19|")
			if (iIndex == 0) { //可直接打印

				doPrint();
			} else if (iIndex2 == 0) {
				closeAdv_vip(3);
			} else {
				var oHtml = data;
				jQuery(this).append(oHtml);
				//充值  购买  企业vip
				if (idflag == "downLoadTips1" || idflag == "downLoadTips2" || idflag == "downLoadTips4" || idflag == "downLoadTips8" || idflag == "downLoadTips9" || idflag == "downLoadTips16") {
					dialogBoxShadow();
				}
				if (idflag != 'downLoadTips3' && idflag != 'downLoadTips7') {
					setObjCenter(idflag);
				}
			}
		}
	});
}

function printPurchase(pid, uid, flag) {
	jQuery.ajax({
		type: 'POST',
		url: "/newEnd/purchaseProduct_new.do",
		dataType: "html",
		async: false,
		context: document.body,
		data: "pid=" + pid + "&purchaserId=" + uid + "&flag=" + flag + "&isPrint=print",
		success: function (data) {

			closeDownLoadDiv('2');
			closeDownLoadDiv(8);
			closeDownLoadDiv(9);
			if (data) {
				console.log(data);
				if (jQuery("#j_print,.doc_print_btn").length > 0) {
					jQuery("#j_print,.doc_print_btn").trigger("click");
				}
			}
		}
	});
}
// txyTest111 格式转换
var convertWatchTimer = null;

function docinConvertHandle() {
	var convertBtn = jQuery('.doc_convert_btn');
	if (convertBtn.length == 0) {
		return false;
	}
	if (convertBtn.length > 0) {
		convertBtn.off('click').on('click', function (event) {
			event.stopPropagation();
			var  convertChoice= jQuery(this).next('.doc_convert_choice');
			jQuery('.doc_convert_choice').hide();
			if (convertChoice.hasClass('temp')) {
				convertChoice.removeClass('temp').hide();
			} else {
				convertChoice.addClass('temp').show();
			}
		})
		jQuery(document).on('click', function(){
			jQuery('.doc_convert_choice').removeClass('temp').hide();
		});
	}
}

function goConvert() {
	jQuery('.doc_convert_choice').removeClass('temp').hide();
}

function clickConvert(pid, fn) {
	jQuery('.doc_convert_choice').removeClass('temp').hide();
	var build_type = "false";
	if (typeof (readerConfig) != "undefined" && readerConfig.isDocin != undefined) {
		build_type = readerConfig.isDocin + '';
	}
	if (convertType == 1) {
		var _toPostfix = "docx";
	} else if (convertType == 2) {
		var _toPostfix = "pdf";
	}
	jQuery.ajax({
		url: '/docinConvert/fileConvert.do',
		data: {
			productId: pid,
			toPostfix: _toPostfix,
			isFreeDoc:typeof (isFreeDoc) != "undefined" ? isFreeDoc : ""
		},
		success: function (res) {
			// -1 参数错误 -2 非会员 -3：用户未购买此文档 -4：该文档已经正在转换 1成功 -5未登录 1成功 2转换成功 -6:超过转换限制
			if (res == -1) {
				alert('参数错误');
			} else if (res == -2) {
				createConvertVipAlert();
			} else if (res == -3) {
				payForConvert(pid, fn);
			} else if (res == -5) {
				jQuery.ajax({
					type: 'GET',
					url: "/newEnd/isAlertLoginLayer.do",
					context: document.body,
					data: "pid=" + tmp_product + "&fn=" + fn + "&build_type=" + build_type + "&isPrint=convert",
					single: 'loginLayer',
					success: function (data) {
						if (data) {
							if (data != "-1") { //未登录时,游客购买
								var oHtml = data;
								jQuery(this).append(oHtml);
								dialogBoxShadow();
								setObjCenter("quickDown");
								lastLoginTips(1);
							} else {
								//普通登录框 用于除大站外其他终极页 如建筑终极页
								var cook = new CookieClass();
								cook.expires = 1;
								cook.domain = ".docin.com";
								cook.path = "/";
								cook.setCookie("convert_login" + tmp_product, "1");
								changeCookieValue(cook, "convert_login" + tmp_product, 1);
							}
						}
					}
				});
			} else if (res == -6) {
				var oTips = jQuery('<div id="msgSendTips" class="transformTips">格式转换100篇/天，请明天再试</div>');
				jQuery('body').append(oTips);
				setTimeout(function () {
					jQuery('#msgSendTips').remove();
				}, 3000);
			} else if (res == -4 || res == 1) {
				convertOperation(pid, fn);
			} else if (res == 2) {
				window.location.href = "/docinConvert/download.do?productId=" + pid;
				successConvert(pid);
			}
		},
		error: function (err) {
			console.log(err);
		}
	})
}
// 转换开通会员提示框
function createConvertVipAlert() {
	var tipText = '';
	var btnText = '';
	var vipHref = '';
	var ipv = 0;
	if (readerConfig.isdocstore != undefined && readerConfig.isdocstore == 1) {
		vipHref = 'https://docstore.docin.com/jsp_cn/my/fin/tool_vip/get_tool_vip.jsp?vipfrom=end';
		btnText = '点击开通会员 享尊贵权益';
		ipv = 6428;
		tipText = '<div class="need-vip-tips-t"><span class="need-vip-tips-tt">开通会员 享转格式功能</span><span class="need-vip-tips-tb">现在开通<span style="color:#f8692a;">享10项特权</span> 低至 <span style="color:#f8692a;">0.5元/天</span></span></div><div class="need-vip-tips-mt"><div class="need-vip-tips-mt-noads"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">阅读文档页<br>零广告</p></div><div class="need-vip-tips-mt-down"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">下载非收费文档<br>100篇/天</p></div><div class="need-vip-tips-mt-downQuan"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">下载收费文档<br>赠专用券</p></div><div class="need-vip-tips-mt-print"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">打印文档<br></p></div></div><div class="need-vip-tips-mb"><a style="text-decoration:none;" href="' + vipHref + '" onmousedown="inpmv('+ipv+')" target="_blank" title="'+btnText+'"><span style="color:#fff;">'+btnText+'</span></a></div>';
	} else if (typeof (isBuilding) != "undefined" && isBuilding == 1) {
		vipHref = 'https://www.docin.com/jsp_cn/my/fin/build_vip/get_build_vip.jsp?pid=null&vip_type=12&vipfrom=end';
		btnText = '点击开通会员 享尊贵权益';
		ipv = 6427;
		tipText = '<div class="need-vip-tips-t"><span class="need-vip-tips-tt">开通会员 享转格式功能</span><span class="need-vip-tips-tb">现在开通<span style="color:#f8692a;">享10项特权</span> 低至 <span style="color:#f8692a;">0.5元/天</span></span></div><div class="need-vip-tips-mt"><div class="need-vip-tips-mt-noads"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">阅读文档页<br>零广告</p></div><div class="need-vip-tips-mt-down"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">下载非收费文档<br>100篇/天</p></div><div class="need-vip-tips-mt-downQuan"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">下载收费文档<br>赠专用券</p></div><div class="need-vip-tips-mt-print"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">打印文档<br></p></div></div><div class="need-vip-tips-mb"><a style="text-decoration:none;" href="' + vipHref + '" onmousedown="inpmv('+ipv+')" target="_blank" title="'+btnText+'"><span style="color:#fff;">'+btnText+'</span></a></div>';
	} else {
		ipv = 7098;
		vipHref = 'https://www.docin.com/app/jump_adv/pay_vip.do?channelid=0313&buyFrom=4';
		btnText = '点击开通VIP 享尊贵权益';
		tipText = '<div class="need-vip-tips-t"><span class="need-vip-tips-tt">开通VIP 享转格式功能</span><span class="need-vip-tips-tb">现在开通<span style="color:#f8692a;">享7项特权</span> 低至 <span style="color:#f8692a;">0.3元/天</span></span></div><div class="need-vip-tips-mt"><div class="need-vip-tips-mt-noads"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">阅读文档页<br>零广告</p></div><div class="need-vip-tips-mt-down"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">下载非收费文档<br>100篇/天</p></div><div class="need-vip-tips-mt-copy"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">复制文本<br></p></div><div class="need-vip-tips-mt-print"><div class="need-vip-tips-mt-bg"></div><p class="need-vip-tips-mt-text">打印文档<br></p></div></div><div class="need-vip-tips-mb"><a style="text-decoration:none;" href="' + vipHref + '" onmousedown="inpmv('+ipv+')" target="_blank" title="'+btnText+'"><span style="color:#fff;">'+btnText+'</span></a></div>';
	}
	var transformForbidden = new CreateDocinDialog({
		title: ' ',
		id: 'need-vip-tips',
		cls: "need-vip-tips",
			title: " ",
			content: tipText,
			button: 2,
	});
}
// 转换前先购买
function payForConvert(pid, fn) {
	var random = new Date().getTime();
	var iCid = 0;
	if (jQuery("#coupon_sel").length > 0) {
		iCid = jQuery('#coupon_sel option:selected').data("cid");
	}
	jQuery.ajax({
		type: 'GET',
		url: "/newEnd/down_load_new_v1.do",
		dataType: "html",
		async: iAsync,
		context: document.body,
		data: "pid=" + pid + "&fn=" + fn + "&flag=down&cid=" + iCid + "&isPrint=convert&datetime=" + random,
		single: "convertDoc",
		success: function (data) {
			var iIndex = data.indexOf("31|");
			var iIndex2 = data.indexOf("29|")
			if (iIndex == 0) {
				clickConvert(pid, fn);
			} else if (iIndex2 == 0) {
				createConvertVipAlert();
			} else {
				var oHtml = data;
				jQuery(this).append(oHtml);
				//充值  购买  企业vip
				if (idflag == "downLoadTips1" || idflag == "downLoadTips2" || idflag == "downLoadTips4" || idflag == "downLoadTips8" || idflag == "downLoadTips9" || idflag == "downLoadTips16") {
					dialogBoxShadow();
				}
				if (idflag != 'downLoadTips3' && idflag != 'downLoadTips7') {
					setObjCenter(idflag);
				}
			}
		}
	});
}

function convertPurchase(pid, uid, flag) {
	var bIsFreeDoc = typeof (isFreeDoc) != "undefined" ? isFreeDoc : "";
	jQuery.ajax({
		type: 'POST',
		url: "/newEnd/purchaseProduct_new.do",
		dataType: "html",
		async: false,
		context: document.body,
		data: "pid=" + pid + "&purchaserId=" + uid + "&flag=" + flag + "&isPrint=convert",
		success: function (data) {
			closeDownLoadDiv('2');
			closeDownLoadDiv(8);
			closeDownLoadDiv(9);
			if (data) {
				clickConvert(pid, bIsFreeDoc);
			}
		}
	});
}

function convertOperation(pid, fn) {
	if (convertType == 1) {
		var picStr = picture_image_path_v1 + '/images_cn/transformation/pdf-word@2x.png';
		var titleStr = "请等候，正在PDF转成Word格式...";
	} else if (convertType == 2) {
		var picStr = picture_image_path_v1 + '/images_cn/transformation/word-pdf@2x.png';
		var titleStr = "请等候，正在Word转成PDF格式...";
	}
	var transformWaiting = new CreateDocinDialog({
		title: ' ',
		id: 'transformWaiting',
		cls: 'transformCls transformWaiting',
		content: '<div class="transform-box"><div class="transform-top"><img src="' + picStr + '" width="71.09" height="80"/><div class="content"><div class="content-top">' + titleStr + '</div><div class="content-bottom"><div class="content-bottom-inner"></div></div></div></div><div class="transform-bottom"><p>温馨提示：</p><p>文档格式转换过程大约需要1分钟，请您耐心等待。</p><p>如果转换时间较长或转换失败，请<a href="javascript:void(0);" class="covert_service">联系客服</a>。</p></div></div>',
		button: 2,
		shadow: 1,
		init: function () {
			jQuery('.content-bottom-inner').animate({
				width: '270px'
			}, 60000);
			convertWatchTimer = setInterval(function () {
				watchConvertResult(pid, fn);
			}, 1000);
		},
		closeCallBack: function () {
			jQuery.ajax({
				url: '/docinConvert/stopConvert.do',
				data: {
					productId: pid
				},
				success: function (res) {},
				error: function (err) {
					console.log(err);
				},
				complete: function () {
					clearInterval(convertWatchTimer);
					return;
				}
			})
		}
	});
}

function watchConvertResult(pid, fn) {
	jQuery.ajax({
		url: '/docinConvert/convertResult.do',
		data: {
			productId: pid
		},
		success: function (res) {
			// 1：转换成功 2：转换失败 
			if (res == 1) {
				clearInterval(convertWatchTimer);
				jQuery('.content-bottom-inner').stop().animate({
					width: '300px'
				}, 1000, function () {
					jQuery('#transformWaiting').remove();
					if (jQuery('#dialogShadow').length > 0) {
						jQuery('#dialogShadow').remove();
					}
					window.location.href = "/docinConvert/download.do?productId=" + pid;
					successConvert(pid);
				})
			} else if (res == 2) {
				clearInterval(convertWatchTimer);
				jQuery('.content-bottom-inner').stop().animate({
					width: '300px'
				}, 1000, function () {
					jQuery('#transformWaiting').remove();
					if (jQuery('#dialogShadow').length > 0) {
						jQuery('#dialogShadow').remove();
					}
					failConvert(pid, fn);
				})
			}
		},
		error: function (err) {
			console.log(err);
		}
	})
}

function successConvert(pid) {
	if (convertType == 1) {
		var picStr = picture_image_path_v1 + '/images_cn/transformation/pdf-word@2x.png';
		var linkStr = urlPrefix.www + '/jsp_cn/convert/pdfConvertWord.jsp';
	} else if (convertType == 2) {
		var picStr = picture_image_path_v1 + '/images_cn/transformation/word-pdf@2x.png';
		var linkStr = urlPrefix.www + '/jsp_cn/convert/wordConvertPdf.jsp';
	}

	var transformSuccess = new CreateDocinDialog({
		title: ' ',
		id: 'transformSuccess',
		cls: 'transformCls transformSuccess',
		content: '<div class="transform-box"><div class="transform-top"><img src="' + picStr + '" width="71.09" height="80"/><div class="content"><div class="content-top">恭喜，文档转换成功。</div><div class="content-bottom" id="downloadAgain">重新下载</div></div></div><div class="transform-bottom"><p>温馨提示：</p><p>' + downTip + '</p><p>如需重转或查看历史转换记录，请<a href="' + linkStr + '" target="_blank">点击此处</a>。</p><p>如果转换时间较长或转换失败，请<a href="javascript:void(0);" class="covert_service">联系客服</a>。</p></div></div>',
		button: 2,
		shadow: 1,
		init: function () {
			jQuery('#downloadAgain').off('click').on('click', function () {
				window.location.href = "/docinConvert/download.do?productId=" + pid;
			})
		}
	});
}

function failConvert(pid, fn) {
	if (convertType == 1) {
		var picStr = picture_image_path_v1 + '/images_cn/transformation/pdf-word@2x.png';
		var linkStr = urlPrefix.www + "/jsp_cn/convert/pdfConvertWord.jsp";
	} else if (convertType == 2) {
		var picStr = picture_image_path_v1 + '/images_cn/transformation/word-pdf@2x.png';
		var linkStr = urlPrefix.www + "/jsp_cn/convert/wordConvertPdf.jsp";
	}
	var transformFail = new CreateDocinDialog({
		title: ' ',
		id: 'transformFail',
		cls: 'transformCls',
		content: '<div class="transform-box"><div class="transform-top"><img src="' + picStr + '" width="71.09" height="80"/><div class="content"><div class="content-top">抱歉，文档转换失败，请稍后再试</div><div class="content-bottom" id="convertAgain">重新转换</div></div></div><div class="transform-bottom"><p>温馨提示：</p><p>如需重转或查看历史转换记录，请<a href="' + linkStr + '" target="_blank">点击此处</a>。</p><p>如果转换时间较长或转换失败，请<a href="javascript:void(0);" class="covert_service">联系客服</a>。</p></div></div>',
		button: 2,
		shadow: 1,
		init: function () {
			jQuery('#convertAgain').off('click').on('click', function () {
				transformFail.closeDialog();
				clickConvert(pid, fn)
			})
		}
	});
}

function initConvert(pid) {
	var cook = new CookieClass();
	var convert_login = cook.getCookie("convert_login" + tmp_product);
	// cook.setCookie("convert_login" + tmp_product, -1);
	var bIsFreeDoc = typeof (isFreeDoc) != "undefined" ? isFreeDoc : "";
	if (convert_login == "1" && tmp_userId > 0) {
		clickConvert(tmp_product, bIsFreeDoc);
	} else if (convert_login == "2" && tmp_userId > 0 && window.location.href.indexOf("isPay") > 0) {
		clickConvert(tmp_product, bIsFreeDoc);
	}
	// delete ConvertCookie 
	cook.deleteCookie("convert_login" + tmp_product);
}
//格式转换 end

//终极页工具栏提示
function hoverLabel() {
	jQuery(document).on("mouseover", "a[data-label]", function () {
		//var oLeft = jQuery(this).offset().left-jQuery(".doc_reader_mod").offset().left;
		var oLeft = jQuery(this).position().left;
		var otop = jQuery(this).offset().top;
		var tempTips = jQuery('<div style="left:' + oLeft + 'px;" class="new_tip opaque"><div class="tip_inner">' + jQuery(this).data('label') + '</div></div>').appendTo(jQuery(".tooltip_container"));
		jQuery(".tooltip_container").show();
		if (jQuery(this).attr("id") == "j_comdoc") {
			var oLeft = jQuery(this).parent().position().left;
		}
		var oGap = (tempTips.width() - jQuery(this).outerWidth()) / 2;
		// if(jQuery(this).hasClass('btn_fullscreen')){
		// 	oGap = (tempTips.width()-68)/2;
		// }
		// else{
		// 	//oGap = (tempTips.width()-30)/2;
		// 	oGap = (tempTips.width()-jQuery(this).outerWidth())/2;
		// }
		tempTips.css({
			left: oLeft - oGap + 'px'
		});
	}).on("mouseleave", "a[data-label]", function () {
		jQuery(".tooltip_container").html("").hide();
	});
	jQuery(".doc_active_info").on("mouseover", "a[data-tips]", function () {
		var oLeft = jQuery(this).position().left;
		var otop = jQuery(this).position().top;
		var tempTips = jQuery('<div id="funcTips" style="left:' + oLeft + 'px;" class="new_tip opaque"><div class="tip_inner">' + jQuery(this).data('tips') + '</div></div>').appendTo(jQuery(".doc_fun_tips"));
		jQuery(".doc_fun_tips").show();
		var oGap1 = (jQuery(this).width() - tempTips.width()) / 2;
		if (jQuery(this).hasClass("ico_arrow")) {
			tempTips.css({
				left: oLeft + oGap1 - 65 + 'px'
			});
		} else {
			tempTips.css({
				left: oLeft + oGap1 + 'px'
			});
		}
	}).on("mouseleave", "a[data-tips]", function () {
		jQuery(".doc_fun_tips").html("").hide();
	});

}
//网站举报
function feekSubmit1(id) {
	var doc = document;
	var content = doc.getElementById("error3").value; //举报内容
	var type = 2; //举报类型
	if (jQuery("input[name='error']:checked").attr("id") == undefined) {
		alert("请您选择举报类型！");
		return false;
	}
	var iCon = jQuery("input[name='error']:checked").val();
	content = content == "" ? iCon : content;
	if (jQuery("input[name='error']:checked").attr("id") == "error6") {
		type = type + 11;
	} else if (jQuery("input[name='error']:checked").attr("id") == "error1") {
		type = type + 3;
	} else if (jQuery("input[name='error']:checked").attr("id") == "error4") {
		type = type + 4;
	} else if (jQuery("input[name='error']:checked").attr("id") == "error8") {
		type = type + 3;
	} else if (jQuery("input[name='error']:checked").attr("id") == "error2") {
		type = type + 5;
		content = jQuery("#purl").val(); //输入的url
		if (content == "" || content.length < 1) { //输入url内容为空
			showFeekError("请输入与本篇重复的文档网址");

			return;
		} else { //输入url不为空
			var begin = content.indexOf("-");
			var end = content.lastIndexOf(".html");
			if (begin == -1 || end == -1) { //输入格式不正确
				showFeekError("请输入正确的网址<br />如：http://www.docin.com/p-23020082.html");

				return;
			} else {

				var reg = new RegExp("^[0-9]*$");
				var jbid = content.substring(begin + 1, end);
				if (!reg.test(jbid)) {
					showFeekError("请输入正确的网址<br />如：http://www.docin.com/p-23020082.html");

					return;
				} else if (parseInt(jbid) > parseInt(id)) { //输入的文档上传时间在举报文档上传时间之后 
					showFeekError("您的举报无效，请核实举报文档的上传时间");

					return;
				} else if (parseInt(jbid) == parseInt(id)) { //输入文档与举报文档为同一文档
					showFeekError("输入文档链接有误，不能举报同一篇文档");

					return;
				}
			}
		}
	}
	var url = "/jsp_cn/jquery/end/update_message.jsp?content=" + encodeURI(content) + "&pid=" + id + "&type=" + type + "&flag=sendFeekBack&date=" + new Date().getTime();
	jQuery.post(url, {
		content: encodeURI(content),
		pid: id,
		type: type,
		flag: "sendFeekBack",
		date: new Date().getTime()
	}, function (data, status) {
		var iData = jQuery.trim(data);
		if (iData == 1) { //举报成功
			alert("举报成功！多谢你的支持！");
			jQuery("#reportAlertLayout").remove();
			jQuery("#dialogShadow").remove();
			if (typeof (docinClipboard) != "undefined") { //清除复制对象
				docinClipboard.destroy();
			}
		} else if (iData == 2) {
			alert('未登录，请登录后举报！');
			jQuery("#reportAlertLayout").remove();
			jQuery("#dialogShadow").remove();
			if (typeof (docinClipboard) != "undefined") { //清除复制对象
				docinClipboard.destroy();
			}
		}
	});
	//jQuery("#a5").load(url);

}

function zqBuySuccess(a, b, c) {
	var iTEL = a == "null" ? "" : a,
		iEmail = b == "null" ? "" : b;
	var iDownNumber = c;
	var iNumberFlag = 0; //省略第一步的开关
	var contentStr = '<div class="zq_success_01">购买成功</div><div class="zq_success_02" style="display:none;">即将跳转第三方网站获取文档</div>';
	contentStr += '<div class="zq_info1">请填写信息，文档将由“掌桥科研”发送至您所填邮箱。</div><div class="zq_info2">请您在新打开的掌桥网站<br/>使用手机号登录，文档将发到您邮箱</div>';
	contentStr += '<div class="zq_form"><div class="zq_wrap"><div class="zq_input_wrap"><label>手机号：</label><input id="zq_tel" name="tel" class="zq_input" type="tel" value="' + iTEL + '" autocomplete="off" /></div><div class="zq_input_wrap"><label>邮&nbsp;&nbsp;箱：</label><input id="zq_email" class="zq_input" value="' + iEmail + '" type="text" autocomplete="off" /></div></div><div class="zq_btn_wrap"><a id="editinfo" class="zq_btn zq_btn_edit" href="javascript:void(0);">修改信息</a><a id="zqNextStep" class="zq_btn" href="javascript:void(0);">下一步</a><a id="zqConfirm" style="display:none;" class="zq_btn" href="javascript:void(0);">我知道了</a></div></div>';
	contentStr += '<div class="zq_warn_tips">掌桥提醒：同一篇文档24小时重复下载3次不额外扣费，超时超限重新扣费。请尽快获取文档。</div>'
	var ddWeixinShare = new CreateDocinDialog({
		title: ' ',
		id: 'jZqSuccess',
		cls: 'zhangQiaoPop',
		content: contentStr,
		button: 2,
		shadow: 1,
		init: function () {
			jQuery("#zqNextStep").on("click", function () {
				if (iDownNumber > 0 && iNumberFlag == 0) {
					jQuery(".zq_form").addClass("zq_form_disabled");
					jQuery(".zq_input").prop("disabled", true);
					jQuery("#editinfo").css('display', 'inline-block');
					jQuery("#zqNextStep").html("立即跳转");
					jQuery(".zq_info1").html("确认以下信息，点击跳转按钮前往“掌桥科研”即可获取文档。");
					jQuery(".zq_success_01").hide();
					jQuery(".zq_success_02").show();
					iNumberFlag = 1;
					return;
				}
				if (!jQuery(".zq_form").hasClass("zq_form_disabled")) {
					var checkResult = checkTelNumber(jQuery("#zq_tel").val());
					showError(checkResult, jQuery("#zq_tel"));
					if (checkResult == 3) {
						var checkEmailResult = checkEmail(jQuery("#zq_email").val());
						showError(checkEmailResult, jQuery("#zq_email"));
						if (checkEmailResult == 3) {
							jQuery(".zq_form").addClass("zq_form_disabled");
							jQuery(".zq_input").prop("disabled", true);
							jQuery("#editinfo").css('display', 'inline-block');
							jQuery("#zqNextStep").html("立即跳转");
							jQuery(".zq_info1").html("确认以下信息，点击跳转按钮前往“掌桥科研”即可获取文档。");
							jQuery(".zq_success_01").hide();
							jQuery(".zq_success_02").show();
						}
					}
				} else {
					jQuery("#editinfo").css('display', 'none');
					jQuery(".zq_success_02,.zq_info1").hide();
					jQuery("#jZqSuccess .dialogTitle h3").html("豆丁提示");
					jQuery(".zq_success_02,.zq_info1").hide();
					jQuery(".zq_info2").show();
					jQuery(".zhangQiaoPop .zq_wrap").css("paddingLeft", "66px");
					jQuery(".zq_form_disabled .zq_btn_wrap").css("paddingTop", "35px");
					jQuery("#zqConfirm").show();
					jQuery("#zqNextStep").hide();
					inpmv(7806);
					var newWindow = window.open();
					jQuery.ajax({
						type: "GET",
						url: "/api/zq/getZqUrl.do",
						data: "phone=" + jQuery("#zq_tel").val() + "&email=" + jQuery("#zq_email").val() + "&product_id=" + readerConfig.productId,
						success: function (iData) {
							console.log(iData);
							if (iData != null) {
								if (iData.status == 1) {
									newWindow.location.href = iData.down_url;
								} else {
									alert("购买出错，请刷新重试！");
								}
							}
						}
					});

				}

			});
			jQuery("#editinfo").on("click", function () {
				jQuery(".zq_form").removeClass("zq_form_disabled");
				jQuery(".zq_input").prop("disabled", false);
				jQuery("#editinfo").css('display', 'none');
				jQuery(".zq_success_02").hide();
				jQuery(".zq_success_01,.zq_info1").show();
				jQuery("#zqNextStep").html("下一步");
				jQuery(".zq_info1").html("请填写信息，文档将由“掌桥科研”发送至您所填邮箱。");
				if (iNumberFlag == 1 && iDownNumber > 0) {
					jQuery(".zq_success_01").addClass("zq_hidebefore").html("填写信息获取文档");
				}
			});
			jQuery("#zqConfirm").on("click", function () {
				ddWeixinShare.closeDialog();
			});
			jQuery("#zq_email").mailAutoComplete();
			jQuery("#zq_tel,#zq_email").on("keydown", function (event) {
				var code;
				if (event.key !== undefined) {
					code = event.key;
				} else if (event.keyIdentifier !== undefined) {
					code = event.keyIdentifier;
				}
				if (code == "Enter" || event.keyCode == 13) {
					jQuery("#zqNextStep").trigger("click");
					return false;
				}
			});
			if (iDownNumber > 0 && iNumberFlag == 0) {
				jQuery("#zqNextStep").trigger("click");
			}
		}
	});
	inpmv(7805);
}
//错误提示信息
function showError(f, thisObj) {
	var iErrorTxt = "";
	if (jQuery(".zq_input_wrap .i_error").length > 0) {
		jQuery(".zq_input_wrap .i_error").remove();
	}
	if (f == 1) {
		iErrorTxt = "请输入";
		thisObj.focus();
	} else if (f == 2) {
		iErrorTxt = "格式不正确";
	}
	if (iErrorTxt != "") {
		jQuery('<span class="i_error">' + iErrorTxt + '</span>').appendTo(thisObj.parent());
	}

}
//验证手机号
function checkTelNumber(phoneNumnber) {
	var loginTel = jQuery.trim(phoneNumnber).replace(/\s*/g, "");
	var typeA = /^(13[0-3]|13[5-9]|145|147|15[0-3]|15[5-9]|170|19[8-9]|17[1-9]|18[0-9]|166)[0-9]{8}$/.test(loginTel);
	var typeB = /^(134[0-8])[0-9]{7}$/.test(loginTel);
	var telNumPass = typeA || typeB;
	if (loginTel == "") {
		return 1;
	} else if (loginTel.length != 11) {
		return 2;
	} else if (!telNumPass) {
		return 2;
	}
	return 3;
}

function checkEmail(email) {
	var filter = /^([a-zA-Z0-9_\-\.\+]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
	if (email == "") {
		return 1;
	} else if (!filter.test(email)) {
		return 2;
	}
	return 3;
}
jQuery(function () {
	if (jQuery("#feekBackDiv").length > 0) {
		jQuery("#feekBackDiv").remove();
	}
	jQuery("#feekback1").off("click").on("click", function () {
		if (isUserLogin == 0) { //用户未登录
			showFeekLogin();
		} else {
			showReport();
		}

		inpmv(7612);
		return false;
	});

	function showReport() {
		var strTitle = '<div class="reportSelect">反馈类别：<label><input type="radio" checked="true" name="retype" />举报</label><label><input type="radio" name="retype" />认领</label></div>';
		var contentStep1 = '<div class="stepWrap"><div class="stepItem"><span class="step step1">step1</span><p class="reason">填写原因/理由</p></div><div class="arrow"></div><div class="stepItem"><span class="step step2">step2</span><p class="reason">提交审核</p></div><div class="arrow"></div><div class="stepItem"><span class="step step3">step3</span><p class="reason">举报成功</p></div></div>';
		var contentType1 = '<dl class="reportType"><dt>举报类型：</dt><dd><div class="rItem"><label><input type="radio" value="举报该文档为侵权文档。" name="error" id="error6">举报该文档为侵权文档。</label></div><div class="rItem"><label><input type="radio" value="举报该文档含有违规或不良信息。" name="error" id="error1">举报该文档含有违规或不良信息。</label></div><div class="rItem"><label><input type="radio" value="涉未成年人举报" name="error" id="error8">涉未成年人举报。</label></div><div class="rItem"><label><input type="radio" value="反馈该文档无法正常浏览。" name="error" id="error4">反馈该文档无法正常浏览。</label></div><div class="rItem"><label><input type="radio" id="error2" name="error" value="举报该文档为重复文档。">举报该文档为重复文档。</label></div><div class="feedBackInput"><div id="repeatproduct" style="display:none;"><input id="purl" type="text" placeholder="请输入与本篇重复的文档网址" /></div><textarea id="error3" placeholder="请输入您的反馈和联系方式"></textarea></div></dd></dl>';
		var btnStr1 = '<div class="reportButtons"><a id="reportConfirm" class="btn_blue" href="javascript:;">确定</a><a class="btn_blue btn_gray" href="javascript:;">取消</a></div>';
		var contentStr1 = '<div class="tips">如果文档无法正常浏览或属于侵权文档，您可以进行举报。</div>' + contentStep1 + contentType1 + btnStr1;
		var contentStep2 = '<div class="stepWrap"><div class="stepItem"><span class="step step1">step1</span><p class="reason">发送申请邮件</p></div><div class="arrow"></div><div class="stepItem"><span class="step step2">step1</span><p class="reason">审核</p></div><div class="arrow"></div><div class="stepItem"><span class="step step3">step1</span><p class="reason">认领结果答复</p></div></div>';
		var contentType2 = '<div class="renLing"><dl class="renLingDl"><dt>提供资料：</dt><dd>1、侵权文档地址链接<span id="copyUrl" class="copyLink">复制</span><input type="hidden" value="' + docinShareConfig.url + '" id="curUrl" /></dd><dd>2、身份证明材料：身份证正面照/护照身份证页照片、联系方式</dd><dd>3、版权证明材料：作品认证证书/作品登记证书/已署名的出版物</dd><dd>4、在邮件中注明认领方式（单选）：<div class="level_sec"> A、认领被侵权文档，获取既往收益（网站推荐）<br/>B、将被侵权文档设为免费下载分享文档<br/>C、要求网站立即删除被侵权的文档</div></dd><dd class="fwb">请按上述格式将资料发送到邮箱，专属客服将为您办理。</dd><dd><span class="fwb">邮箱标题</span>：认领文档&nbsp;&nbsp;&nbsp;&nbsp;<span class="fwb">邮箱地址</span>：<img src="https://t.docin.com/images_cn/news/html_reader/docin_email.png" style="width:164px;vertical-align:middle;" /><span id="copyEmail" class="copyLink">复制</span><input type="hidden" value="copyright@docin.com" id="emailAdrr" /></dd></dl></div>';
		var btnStr2 = '<div class="reportButtons"><a id="okKownBtn" class="btn_blue" href="javascript:;">我知道了</a></div>';
		var contentStr2 = '<div class="tips">如果您是本文作者，您可以提交资料认领文档或下架侵权文档</div>' + contentStep2 + contentType2 + btnStr2;
		var openReportAlert = new CreateDocinDialog({
			id: "reportAlertLayout",
			cls: "reportAlertLayout",
			title: strTitle,
			content: '<div class="feedwrap feedback1">' + contentStr1 + '</div><div class="feedwrap feedback2" style="display:none;">' + contentStr2 + '</div>',
			button: 2,
			init: function () {
				var aSelectInput = jQuery(".reportSelect input[name='retype']");
				if (aSelectInput.length > 0) {
					aSelectInput.on("click", function () {
						var iIndex = aSelectInput.index(jQuery(this));
						jQuery(".feedwrap").hide();
						jQuery('.feedback' + (iIndex + 1)).show();
						if (iIndex == 1) {
							inpmv(7611);
						}
					});
				}
				jQuery("#reportAlertLayout .reportButtons .btn_gray").on("click", function () {
					openReportAlert.closeDialog();
					return false;
				});
				jQuery("#reportConfirm").on("click", function () {
					feekSubmit1(readerConfig.productId);
				});
				jQuery("#okKownBtn").on("click", function () {
					openReportAlert.closeDialog();
					return false;
				});
				jQuery("input[name='error']").on("click", function () {
					if (jQuery(this).attr("id") == "error2") {
						jQuery("#repeatproduct").show();
					} else {
						jQuery("#repeatproduct").hide();
						jQuery("#purl").val("");
						if (jQuery("#feekTips").length > 0) {
							jQuery("#feekTips").remove();
						}
					}
				});
				// jQuery("#reportAlertLayout .dialog_closed").on("click",function(){
				// 	if(typeof(docinClipboard)!="undefined"){//清除复制对象
				// 		docinClipboard.destroy();
				// 	}
				// });
				docinCopyData('copyUrl', 'curUrl', 2);
				docinCopyData('copyEmail', 'emailAdrr', 2);
				jubaoFlag = 1; //分享复制初始化标志
			}
		});
	}
	initshowfeek();
});
jQuery(function () {
	docinPrintHandel();
	initPrint(product_id);
	docinConvertHandle();
	initConvert(product_id);
	docFuncHover();
});

jQuery(function () {
	if (jQuery(".nav_end_sty2").length > 0 && jQuery(".doc_fun_wrap").length > 0) {
		jQuery(".nav_end_sty2").append(jQuery(".doc_fun_wrap").clone(true));
	}
	if (jQuery(".J_Top .top_wrap").length > 0 && jQuery(".doc_fun_wrap").length > 0) {
		jQuery(".J_Top .top_wrap").append(jQuery(".doc_fun_wrap").clone(true));
	}

	if (jQuery(".info_open").length > 0) {
		jQuery(".info_open").on("click", function () {
			if (jQuery(this).hasClass("open_down")) {
				jQuery(".doc_detail_wrap").show();
				jQuery(this).removeClass("open_down");
				jQuery(this).addClass("open_up");
				jQuery(this).find("span").html("收起");
			} else if (jQuery(this).hasClass("open_up")) {
				jQuery(".doc_detail_wrap").hide();
				jQuery(this).removeClass("open_up");
				jQuery(this).addClass("open_down");
				jQuery(this).find("span").html("展开");
			} else if (jQuery(this).hasClass("open_down_svg")) {
				jQuery(".doc_detail_wrap").show();
				jQuery(this).removeClass("open_down_svg");
				jQuery(this).addClass("open_up_svg");
				jQuery(this).find("span").html("收起");
			} else if (jQuery(this).hasClass("open_up_svg")) {
				jQuery(".doc_detail_wrap").hide();
				jQuery(this).removeClass("open_up_svg");
				jQuery(this).addClass("open_down_svg");
				jQuery(this).find("span").html("展开");
			}

		});
	}
	if (jQuery(".head_wrapper").length > 0) {
		jQuery(window).on("scroll", function () {
			if (jQuery(".doc_header_mod .doc_fun_wrap").length > 0) {
				var iStartFixTop = jQuery(".doc_header_mod .doc_fun_wrap").offset().top;
			} else {
				var iStartFixTop = jQuery(".head_wrapper").height();
			}

			var iScrollTop = jQuery(window).scrollTop();
			if (iScrollTop >= iStartFixTop) {
				if (jQuery(".doc_hd_mini").length > 0) {
					if (!jQuery(".doc_hd_mini").hasClass("fixed_header_tool")) {
						jQuery(".doc_hd_mini").addClass("fixed_header_tool");
						jQuery("body").addClass("fixedStyle");
					}
				} else if (jQuery(".head_wrapper .J_Top").length > 0) {
					if (!jQuery(".head_wrapper .J_Top").hasClass("fixed_header_tool")) {
						jQuery(".head_wrapper .J_Top").addClass("fixed_header_tool");
						jQuery("body").addClass("fixedStyle");
					}
				}

			} else {
				if (jQuery(".doc_hd_mini").length > 0) {
					if (jQuery(".doc_hd_mini").hasClass("fixed_header_tool")) {
						jQuery(".doc_hd_mini").removeClass("fixed_header_tool");
						jQuery("body").removeClass("fixedStyle");
					}
				} else if (jQuery(".head_wrapper .J_Top").length > 0) {
					if (jQuery(".head_wrapper .J_Top").hasClass("fixed_header_tool")) {
						jQuery(".head_wrapper .J_Top").removeClass("fixed_header_tool");
						jQuery("body").removeClass("fixedStyle");
					}
				}

			}
		});
	}

	//关注
	if (jQuery("#addConcern").length == 1) {
		jQuery("#addConcern").on("click", function () {
			var random = new Date().getTime();
			if (jQuery(this).hasClass("concernSuccess")) {
				jQuery.ajax({
					type: 'GET',
					url: "/app/my/docin/delfollow",
					data: "ajax=1&userid=" + readerConfig.userId + "&datetime=" + random,
					single: "addConcern",
					success: function (data) { //-1用户未登录  0 userid不合法  1取消成功
						console.log(data);
						if (data == 1) {
							jQuery("#addConcern").html("关注");
							jQuery("#addConcern").removeClass("concernSuccess");
						} else if (data == -1) {
							showlogin();
						}
					}
				});
				inpmv(7757); //取消关注点击量
			} else {
				jQuery("#addConcern").html('<span style="color:#ccc;">关注中..</span>');
				jQuery.ajax({
					type: 'GET',
					url: "/app/my/docin/addfollow",
					data: "ajax=1&userid=" + readerConfig.userId + "&datetime=" + random,
					single: "addConcern",
					success: function (data) { //-1用户未登录  0 userid不合法  1关注成功  2 关注数超过500人  3  关注自己
						jQuery("#addConcern").html('关注');
						if (data == 3) {
							alert("您不能关注自己！");
						} else if (data == -1) {
							showlogin();
						} else if (data == 2) {
							alert("您的关注已达上限，不能再关注！");
						} else if (data == 1) {
							jQuery("#addConcern").html('<span class="i_gou"><img src="' + picture_image_path_v1 + '/images_cn/news/viewMode/duihao.png"><span class="mmsk"></span></span>');
							jQuery("#addConcern").attr("onmousedown", "return inpmv(7756);");
							setTimeout(function () {
								jQuery("#addConcern").html("取消关注");
								jQuery("#addConcern").addClass("concernSuccess");
							}, 1000);
						}
					}
				});
				inpmv(7756); //关注点击量
			}

		});
	}
});
//版权分销
jQuery(function () {
	function showShareLogin(id,pid) {
		var cook = new CookieClass();
		cook.expires = 10;
		cook.domain = ".docin.com";
		cook.path = "/";
		cook.setCookie("showShareClickId", "showShare");
		changeCookieValue(cook, "showShareClickId",pid);
	}

	function initShowShare() {
		var cook = new CookieClass();
		var remindClickId = cook.getCookie("showShareClickId");
		// console.log('tmp_userId', tmp_userId)
		if (remindClickId == "showShare" && tmp_userId > 0) {
			setTimeout(function () {
				jQuery(".share_award:first").trigger("click");
			}, 2000);
		}

		cook.expires = 1;
		cook.domain = ".docin.com";
		cook.path = "/";
		cook.setCookie("showShareClickId", -1);
	}

	function shareToAward(f,iData) {
		var classStr = 'shareDocWrap';
		var contentStr = "";
		var copyUrl = f == 0 ? 'https://www.docin.com/p-' + readerConfig.productId + '.html' : iData.shareUrl;
		docinShareConfig.url = copyUrl;

		var userShareList = '';
		for (var l=0; l<iData.array.length; l++){
			userShareList += '<p class="i_list">'+ iData.array[l].name +' 分享文档共赢得了 '+  iData.array[l].money +' 豆元</p>'
		}

		var strShare = '<dl class="shareDocinBox marb15 clear"><dt>将文档分享至：</dt><dd><div class="dsharebuttonbox"><a onclick="docinShare(2,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到QQ空间" class="ds_qzone"></a><a onclick="docinShare(1,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到新浪微博" class="ds_tsina"></a><a onclick="docinShare(5,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到QQ好友" class="ds_sqq"></a><a onclick="docinShare(6,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到微信" class="ds_weixin"></a></div></dd></dl>';
		var strShareUrl = '<div class="i_tit">分享完整地址</div><div class="endShareUrl end_jl clear"><span class="endUrl_tit">文档地址：</span><input type="text" name="textUrl" id="textUrl1" class="tUrl" value="' + copyUrl + '"><a id="docUrl" style="z-index:1000;" class="btn_blue" href="javascript:;">复制</a></div>';
		if (f == 0) {//登录前
			classStr = 'shareDocWrap shareDocWrapBeforeLogin';

			strShare = '<dl class="shareDocinBox marb15 clear"><dd><div class="dsharebuttonbox"><div class="share_big_wrap"><a onclick="docinShare(6,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到微信" class="ds_weixin"><div class="share_big_title">微信</div></a></div><div class="share_big_wrap"><a onclick="docinShare(1,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到新浪微博" class="ds_tsina"><div class="share_big_title">微博</div></a></div><div class="share_big_wrap"><a onclick="docinShare(5,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到QQ好友" class="ds_sqq"><div class="share_big_title">QQ</div></a></div><div class="share_big_wrap"><a onclick="docinShare(2,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到QQ空间" class="ds_qzone"><div class="share_big_title">QQ空间</div></a></div><div class="share_big_wrap"><a id="docUrl" href="javascript:void(0);" title="复制链接" class="ds_copy_url"><input type="hidden" name="textUrl" id="textUrl1" class="tUrl" value="' + copyUrl + '"><div class="share_big_title">复制链接</div></a></div></div></dd></dl>';

			contentStr = '<div class="ddWeixinShareClose"></div><div class="share_award_bd login_before"><div class="share_award_t clear"><div class="share_big"><div class="i_tit">文档分享至</div>' + strShare + '</div><div class="dimcode_pic_wrap"><div class="dimcode_pic_title">微信扫一扫分享</div><div class="dimcode_pic"><img id="dimcode_pic" width="135" height="135" alt="获取二维码" title="获取二维码" src="/servlet/get2wm?doc_end_url=' + iData.shareUrl + '"><i id="dimcode_docin_icon" class="ico_docin_dimcode" style="display: block;"></i></div></div></div><div class="share_award_b"><div class="share_text_title"><span>'+ iData.count +'用户已参与活动</span></div>	<div class="share_text"><p class="i_list"><span class="fcr">您目前是未登录进行文档分享。</span></p><p class="i_list">登录后即可生成您的专属分享链接。通过专属分享链接带来该篇文档的每次成功交易，您即可收获每次最高<span class="fcr">10%</span>赏金(<span class="fcr">'+ iData.shareMoney +'豆元</span>)。</p><div class="login_share_wrap"><span class="btn_share_login">登录赚钱</span></div></div></div></div>';
		} else if (f == 1) {//登陆后
			classStr = 'shareDocWrap shareDocWrapAfterLogin';

			strShare = '<dl class="shareDocinBox marb15 clear"><dt>文档分享至：</dt><dd><div class="dsharebuttonbox"><a onclick="docinShare(6,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到微信" class="ds_weixin"></a><a onclick="docinShare(1,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到新浪微博" class="ds_tsina"></a><a onclick="docinShare(5,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到QQ好友" class="ds_sqq"></a><a onclick="docinShare(2,event,2,' + readerConfig.productId + ');" href="javascript:void(0);" title="分享到QQ空间" class="ds_qzone"></a><a id="docUrl" href="javascript:void(0);" title="复制链接" class="ds_copy_url"><input type="hidden" name="textUrl" id="textUrl1" class="tUrl" value="' + copyUrl + '"></a></div></dd></dl>';

			strShareUrl = '<div class="endShareUrl end_jl clear"><input type="text" name="textUrl" id="textUrl1" class="tUrl" value="' + copyUrl + '"><a id="docUrl" style="z-index:1000;" class="btn_blue" href="javascript:;">复制地址</a></div>';

			contentStr = '<div class="ddWeixinShareClose"></div><div class="share_award_bd login_after"><div class="share_award_t clear"><div class="dimcode_pic"><img id="dimcode_pic" width="135" height="135" alt="获取二维码" title="获取二维码" src="/servlet/get2wm?doc_end_url=' + iData.shareUrl + '"><i id="dimcode_docin_icon" class="ico_docin_dimcode" style="display: block;"></i></div><div class="share_text"><h4>百万元平台补助，已有<span class="fcp">'+ iData.count +'</span>人参与：</h4><div class="userShareList"><div class="userShareListMove">'+ userShareList +'</div></div></div></div><div class="share_award_b"><div class="i_tit"><span class="fcr">您的专属分享链接已生成</span>，通过专属分享链接带来该篇文档的每次成功交易，您即可收获每次最高<span class="fcr">10%</span>赏金(<span class="fcr">'+ iData.shareMoney +'豆元</span>)。</div>' + strShareUrl + strShare + '</div></div>';
		}

		var ddWeixinShare = new CreateDocinDialog({
			title: ' ',
			id: 'j_shareDoc',
			cls: classStr,
			content: contentStr,
			button: 2,
			shadow: 1,
			init: function () {
				var userShareListMoveTimer;
				jQuery('.shareDocWrapBeforeLogin .dialogTitle').remove();
				jQuery('.shareDocWrapAfterLogin .dialogTitle').remove();
				if (jQuery(".btn_share_login").length > 0) {
					jQuery(".btn_share_login").on("click", function () {
						ddWeixinShare.closeDialog();
						clearInterval(userShareListMoveTimer);
						showShareLogin('showShareAwardValue',readerConfig.productId + "&registerFrom=1");
            inpmv(7910);
					});
				}
				if (jQuery('.userShareListMove').length) {
					// var o = jQuery('.userShareList').height();
					// var m = jQuery(jQuery('.userShareListMove').children()[0]).height();
					// var t = 0;
					// userShareListMoveTimer = setInterval(function() {
					// 	t = parseInt(jQuery('.userShareListMove').css('top')) - m;
					// 	if (jQuery('.userShareListMove').height() - o + t == 0) {
					// 		t = 0;
					// 	}
					// 	jQuery('.userShareListMove').css({'top': t+'px'})
					// }, 1000);
					var m = jQuery(jQuery('.userShareListMove').children()[0]).height();
					userShareListMoveTimer = setInterval(function() {
						var clone = jQuery(jQuery('.userShareListMove').children()[0]).clone();
						jQuery('.userShareListMove').append(clone);
						jQuery('.userShareListMove').css({'transition': 'top .5s ease'});
						jQuery('.userShareListMove').css({'top': 0-m+'px'});
						setTimeout(function() {
							jQuery('.userShareListMove').css({'transition': 'inherit'});
							jQuery('.userShareListMove').css({'top': 0});
							jQuery(jQuery('.userShareListMove').children()[0]).remove();
						}, 500);
					}, 1000);
				}
				jQuery('.ddWeixinShareClose').on('click', function(){
					ddWeixinShare.closeDialog();
					clearInterval(userShareListMoveTimer);
				});
				docinCopyData('docUrl', 'textUrl1', 1);
				shareFlag = 1; //分享复制初始化标志
			}
		});
	}
	jQuery(".share_award, #docinShareSlider").on("click", function () {
		if (typeof readerConfig.sharePro != 'undefined' && readerConfig.sharePro == 'false' && jQuery(this).attr('id') == 'docinShareSlider') {
			return;
		}
		jQuery.ajax({
			type: "GET",
			url: "/touchPay/sharePro.do",
			data: "pid=" + readerConfig.productId,
			success: function (re) {
				var iData = JSON.parse(re);
				if (iData.status == 1) {
					shareToAward(1, iData);
				} else if (iData.status == 0) {
					shareToAward(0, iData);
				}
			}
		});
		return false;
	});

	initShowShare();
});
((function(){
	// 文档回访链接加优
	jQuery.get("/app/s/g");
})());

jQuery(function(){
	// PC端终极页增加审核工具箱
	if (typeof(isUserLogin) !== 'undefined' && isUserLogin === '1') {
		var adminName = '';
		jQuery.ajax({
			type: 'GET',
			url: '/p/end/ajax/isPrivilege.do',
			success: function(res){
				console.log(res)
				if (res && res.data) {
					adminName = res.user;
					var editorData = res.data;
					var editorStr = '<div class="editorbox"><p class="boxtitle">审核工具箱</p>';
					for (var i=0; i<editorData.length; i++) {
						editorStr += '<span data-id="'
											+ editorData[i].id +'" data-name="'
											+ editorData[i].name +'">'
											+ editorData[i].name +'</span>';
					}
					editorStr += '</div>';
					jQuery('body').append(editorStr);
				}
			}
		});

		jQuery(document).on('click', '.editorbox span', function(){
			var id = jQuery(this).attr('data-id');
			var name = jQuery(this).attr('data-name');
			var editor = new CreateDocinDialog({
				id: "editor",
				cls: "editor",
				title: '确认删除该文档吗？',
				content: '<p style="color: #999;line-height: 23px;">是否要删除该文档并置为“'
					+ name +'”级别吗？<br>Admin-editor: '
					+ adminName +'</p>',
				button: 1,
				cancel: {
					txt: "取消",
					value: true
				},
				confirm: {
					txt: "删除",
					value: true
				},
				callBack: {
					okBack: function () {
						console.log('okBack:', id)
						if (typeof(product_id) === 'undefined') {
							alert('product_id is undefined')
							return;
						}
						var pid = product_id;
						jQuery.ajax({
							type: 'GET',
							url: '/p/end/ajax/audit.do',
							data: {
								//  参数  
								//  文档id      pid
								//  要删除的级别   level
								pid: pid,
								level: id,
							},
							success: function(res){
								// 	* 1  不是公司ip下
								// 	* 2  未登录
								// 	* 3  用户不对
								// 	* 4  参数不对
								// 	* 5  请求成功
								switch (res) {
									case 1:
										alert('不是公司ip下');
										break;
									case 2:
										alert('未登录')
										break;
									case 3:
										alert('用户不对');
										break;
									case 4:
										alert('参数不对');
										break;
									case 5:
										alert('请求成功');
										editor.closeDialog()
										break;
								}
							}
						});
					},
					noBack: function () {
						return false;
					}
				},
			})
		});
	}
});